<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Unofficial AirPlay Specification</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="css/table.css">
        
        <link rel="stylesheet" href="css/examples.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <div id="examples-select"></div>
                <ol class="chapter"><li class="expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="service_discovery.html"><strong aria-hidden="true">2.</strong> Service Discovery</a></li><li class="expanded "><a href="features.html"><strong aria-hidden="true">3.</strong> Features</a></li><li class="expanded "><a href="status_flags.html"><strong aria-hidden="true">4.</strong> Status Flags</a></li><li class="expanded "><a href="photos/index.html"><strong aria-hidden="true">5.</strong> Photos</a></li><li><ol class="section"><li class="expanded "><a href="photos/http_requests.html"><strong aria-hidden="true">5.1.</strong> HTTP Requests</a></li><li class="expanded "><a href="photos/events.html"><strong aria-hidden="true">5.2.</strong> Events</a></li><li class="expanded "><a href="photos/photo_caching.html"><strong aria-hidden="true">5.3.</strong> Photo Caching</a></li><li class="expanded "><a href="photos/slideshows.html"><strong aria-hidden="true">5.4.</strong> Slideshows</a></li></ol></li><li class="expanded "><a href="video/index.html"><strong aria-hidden="true">6.</strong> Video</a></li><li><ol class="section"><li class="expanded "><a href="video/http_requests.html"><strong aria-hidden="true">6.1.</strong> HTTP Requests</a></li><li class="expanded "><a href="video/events.html"><strong aria-hidden="true">6.2.</strong> Events</a></li></ol></li><li class="expanded "><a href="audio/index.html"><strong aria-hidden="true">7.</strong> Audio</a></li><li><ol class="section"><li class="expanded "><a href="audio/rtsp_requests/index.html"><strong aria-hidden="true">7.1.</strong> RTSP Requests</a></li><li><ol class="section"><li class="expanded "><a href="audio/rtsp_requests/get_info.html"><strong aria-hidden="true">7.1.1.</strong> GET /info</a></li><li class="expanded "><a href="audio/rtsp_requests/post_pair_setup.html"><strong aria-hidden="true">7.1.2.</strong> POST /pair-setup</a></li><li class="expanded "><a href="audio/rtsp_requests/post_pair_verify.html"><strong aria-hidden="true">7.1.3.</strong> POST /pair-verify</a></li><li class="expanded "><a href="audio/rtsp_requests/post_fp_setup.html"><strong aria-hidden="true">7.1.4.</strong> POST /fp-setup</a></li><li class="expanded "><a href="audio/rtsp_requests/post_auth_setup.html"><strong aria-hidden="true">7.1.5.</strong> POST /auth-setup</a></li><li class="expanded "><a href="audio/rtsp_requests/options.html"><strong aria-hidden="true">7.1.6.</strong> OPTIONS</a></li><li class="expanded "><a href="audio/rtsp_requests/announce.html"><strong aria-hidden="true">7.1.7.</strong> ANNOUNCE</a></li><li class="expanded "><a href="audio/rtsp_requests/setup.html"><strong aria-hidden="true">7.1.8.</strong> SETUP</a></li><li class="expanded "><a href="audio/rtsp_requests/setpeers.html"><strong aria-hidden="true">7.1.9.</strong> SETPEERS</a></li><li class="expanded "><a href="audio/rtsp_requests/post_command.html"><strong aria-hidden="true">7.1.10.</strong> POST /command</a></li><li class="expanded "><a href="audio/rtsp_requests/post_feedback.html"><strong aria-hidden="true">7.1.11.</strong> POST /feedback</a></li><li class="expanded "><a href="audio/rtsp_requests/post_audio_mode.html"><strong aria-hidden="true">7.1.12.</strong> POST /audioMode</a></li><li class="expanded "><a href="audio/rtsp_requests/record.html"><strong aria-hidden="true">7.1.13.</strong> RECORD</a></li><li class="expanded "><a href="audio/rtsp_requests/flush.html"><strong aria-hidden="true">7.1.14.</strong> FLUSH</a></li><li class="expanded "><a href="audio/rtsp_requests/flushbuffered.html"><strong aria-hidden="true">7.1.15.</strong> FLUSHBUFFERED</a></li><li class="expanded "><a href="audio/rtsp_requests/teardown.html"><strong aria-hidden="true">7.1.16.</strong> TEARDOWN</a></li></ol></li><li class="expanded "><a href="audio/rtp_streams.html"><strong aria-hidden="true">7.2.</strong> RTP Streams</a></li><li class="expanded "><a href="audio/volume_control.html"><strong aria-hidden="true">7.3.</strong> Volume Control</a></li><li class="expanded "><a href="audio/metadata.html"><strong aria-hidden="true">7.4.</strong> Metadata</a></li><li class="expanded "><a href="audio/airport_express_authentication.html"><strong aria-hidden="true">7.5.</strong> AirPort Express Authentication</a></li><li class="expanded "><a href="audio/remote_control.html"><strong aria-hidden="true">7.6.</strong> Remote Control</a></li></ol></li><li class="expanded "><a href="screen_mirroring/index.html"><strong aria-hidden="true">8.</strong> Screen Mirroring</a></li><li><ol class="section"><li class="expanded "><a href="screen_mirroring/http_requests.html"><strong aria-hidden="true">8.1.</strong> HTTP Requests</a></li><li class="expanded "><a href="screen_mirroring/stream_packets.html"><strong aria-hidden="true">8.2.</strong> Stream Packets</a></li><li class="expanded "><a href="screen_mirroring/time_synchronization.html"><strong aria-hidden="true">8.3.</strong> Time Synchronization</a></li></ol></li><li class="expanded "><a href="pairing/index.html"><strong aria-hidden="true">9.</strong> Pairing</a></li><li><ol class="section"><li class="expanded "><a href="pairing/hkp.html"><strong aria-hidden="true">9.1.</strong> HomeKit Based Pairings</a></li><li class="expanded "><a href="pairing/legacy.html"><strong aria-hidden="true">9.2.</strong> Legacy Pairing</a></li></ol></li><li class="expanded "><a href="known_implementations.html"><strong aria-hidden="true">10.</strong> Known Implementations</a></li><li class="expanded "><a href="contributing.html"><strong aria-hidden="true">11.</strong> Contributing</a></li><li class="expanded "><a href="history.html"><strong aria-hidden="true">12.</strong> History</a></li><li class="expanded "><a href="resources.html"><strong aria-hidden="true">13.</strong> Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Unofficial AirPlay Specification</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>AirPlay is a family of protocols implemented by Apple to view various
types of media content on the <em>Apple TV</em> from any iOS device or iTunes.
In this documentation, “<em>iOS device</em>” refers to an iPhone, iPod touch or
iPad. The following scenarios are supported by AirPlay:</p>
<ul>
<li>Display photos and slideshows from an iOS device.</li>
<li>Stream audio from an iOS device or iTunes.</li>
<li>Display videos from an iOS device or iTunes.</li>
<li>Show the screen content from an iOS device or OS X Mountain Lion.
This is called <em>AirPlay Mirroring</em>. It requires hardware capable of
encoding live video without taking too much CPU, so it is only
available on iPhone 4S, iPad 2, the new iPad, and Macs with Sandy
Bridge CPUs.</li>
</ul>
<p>Audio streaming is also supported from an iOS device or iTunes to an
AirPort Express base station or a 3<sup>rd</sup> party AirPlay-enabled audio
device. Initially this was called <em>AirTunes</em>, but it was later renamed
to AirPlay when Apple added video support for the Apple TV.</p>
<p>This document describes these protocols, as implemented in Apple TV
software version 5.0, iOS 5.1 and iTunes 10.6. They are based on
well-known standard networking protocols such as <em>Multicast DNS</em>,
<em>HTTP</em>, <em>RTSP</em>, <em>RTP</em>, <em>PTP</em> or <em>NTP</em>, with custom extensions.</p>
<p>All these information have been gathered by using various techniques of
reverse engineering, so they might be somewhat inaccurate and
incomplete.</p>
<h1><a class="header" href="#service-discovery" id="service-discovery">Service Discovery</a></h1>
<p>AirPlay does not require any configuration to be able to find compatible
devices on the network, thanks to [DNS-based service discovery], based
on [Multicast DNS], aka <em>Bonjour</em>.</p>
<p>An AirPlay device such as the Apple TV publishes two services.
The first one is the <em>Airplay</em> for photo and video
and in later versions also audio content and the other one is [RAOP], used for audio streaming and in later versions superseded by <em>Airplay</em> service.</p>
<h2><a class="header" href="#_airplay_tcp" id="_airplay_tcp">_airplay._tcp</a></h2>
<pre><code>name: Apple TV
type: _airplay._tcp
port: 7000
txt:
  deviceid=58:55:CA:1A:E2:88
  features=0x39f7
  model=AppleTV2,1
  srcvers=130.14
</code></pre>
<p>The following fields are available in the TXT record:</p>
<table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>model</td><td>string</td><td>device model</td></tr>
<tr><td>manufacturer</td><td>string</td><td>device manufacturer</td></tr>
<tr><td>serialNumber</td><td>string</td><td>device serial number</td></tr>
<tr><td>fv</td><td>string</td><td>device firmware version</td></tr>
<tr><td>osvers</td><td>string</td><td>device OS version</td></tr>
<tr><td>deviceid</td><td>string</td><td>Device ID. Usually MAC address of the device</td></tr>
<tr><td>features</td><td>32 bit hex number,optional high order 32 bit hex number</td><td>bitfield of supported <a href="./features.html">features</a>. This was originally a 32 bit value but it has since been expanded to a 64 bit value. To support both these types the mDNS value is encoded as two 32 bit values separated by comma with the comma and second 32 bit value being optional.</td></tr>
<tr><td>pw</td><td>boolean</td><td>server is password protected</td></tr>
<tr><td>acl</td><td>int64</td><td>Access control level</td></tr>
<tr><td>srcvers</td><td>string</td><td>airplay version</td></tr>
<tr><td>flags</td><td>20 bit hex number</td><td>bitfield of <a href="./status_flags.html">status flags</a></td></tr>
<tr><td>pk</td><td>hex string</td><td>public key</td></tr>
<tr><td>pi</td><td>UUID string</td><td>group_id / PublicCUAirPlayPairingIdentifier</td></tr>
<tr><td>psi</td><td>UUID string</td><td>PublicCUSystemPairingIdentifier</td></tr>
<tr><td>gid</td><td>UUID string</td><td>group UUID</td></tr>
<tr><td>gcgl</td><td>boolean</td><td>group contains group leader / Group contains discoverable leader</td></tr>
<tr><td>igl</td><td>boolean</td><td>is group leader</td></tr>
<tr><td>gpn</td><td>string</td><td>group public name</td></tr>
<tr><td>hgid</td><td>UUID string</td><td>home group UUID</td></tr>
<tr><td>hmid</td><td>string</td><td>household ID</td></tr>
<tr><td>pgcgl</td><td>boolean</td><td>parent group contains discoverable leader</td></tr>
<tr><td>pgid</td><td>UUID string</td><td>parent group UUID</td></tr>
<tr><td>tsid</td><td>UUID string</td><td>3008B5C8-9BD3-4479-A564-90BFB3D780C0</td></tr>
<tr><td>rsf</td><td>64 bit hex number</td><td>required sender features</td></tr>
<tr><td>protovers</td><td>string</td><td>protocol version</td></tr>
<tr><td>vv</td><td>?</td><td>vodka version</td></td></tr>
</tbody></table>
<h2><a class="header" href="#_raop_tcp" id="_raop_tcp">_raop._tcp</a></h2>
<pre><code>name: 5855CA1AE288@Apple TV
type: _raop._tcp
port: 49152
txt:
  txtvers=1
  ch=2
  cn=0,1,2,3
  da=true
  et=0,3,5
  md=0,1,2
  pw=false
  sv=false
  sr=44100
  ss=16
  tp=UDP
  vn=65537
  vs=130.14
  am=AppleTV2,1
  sf=0x4
</code></pre>
<p>The name is formed using the MAC address of the device and the name of
the remote speaker which will be shown by the clients.</p>
<p>The following fields appear in the TXT record:</p>
<table><thead><tr><th>name</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>txtvers</td><td>1</td><td>TXT record version 1</td></tr>
<tr><td>ch</td><td>2</td><td>audio channels: stereo</td></tr>
<tr><td>cn</td><td>0,1,2,3</td><td>audio codecs</td></tr>
<tr><td>et</td><td>0,3,5</td><td>supported encryption types</td></tr>
<tr><td>md</td><td>0,1,2</td><td>supported metadata types</td></tr>
<tr><td>pw</td><td>false</td><td>does the speaker require a password?</td></tr>
<tr><td>sr</td><td>44100</td><td>audio sample rate: 44100 Hz</td></tr>
<tr><td>ss</td><td>16</td><td>audio sample size: 16-bit</td></tr>
<tr><td>tp</td><td>UDP</td><td>supported transport: TCP or UDP</td></tr>
<tr><td>vs</td><td>130.14</td><td>server version 130.14</td></tr>
<tr><td>am</td><td>AppleTV2,1</td><td>device model</td></tr>
</tbody></table>
<h3><a class="header" href="#audio-codecs" id="audio-codecs">Audio codecs</a></h3>
<table><thead><tr><th>cn</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>PCM</td></tr>
<tr><td>1</td><td>Apple Lossless (ALAC)</td></tr>
<tr><td>2</td><td>AAC</td></tr>
<tr><td>3</td><td>AAC ELD (Enhanced Low Delay)</td></tr>
</tbody></table>
<h3><a class="header" href="#encryptionauthentication-types" id="encryptionauthentication-types">Encryption/Authentication Types</a></h3>
<table><thead><tr><th>et</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>no encryption</td></tr>
<tr><td>1</td><td>RSA (AirPort Express)</td></tr>
<tr><td>3</td><td>FairPlay</td></tr>
<tr><td>4</td><td>MFiSAP (3rd-party devices)</td></tr>
<tr><td>5</td><td>FairPlay SAPv2.5</td></tr>
</tbody></table>
<h3><a class="header" href="#metadata-types" id="metadata-types">Metadata Types</a></h3>
<table><thead><tr><th>md</th><th>bit</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>17</td><td>text</td></tr>
<tr><td>1</td><td>15</td><td>artwork</td></tr>
<tr><td>2</td><td>16</td><td>progress</td></tr>
<tr><td></td><td>50</td><td>bplist</td></tr>
</tbody></table>
<h3><a class="header" href="#subtype" id="subtype">Subtype</a></h3>
<pre><code>AppleTV = deviceModel has prefix “AppleTV”
HomePod = deviceModel has prefix “AudioAccessory”
ThirdPartySpeaker = HasUnifiedAdvertiserInfo or SupportsUnifiedPairSetupAndMFi feature is set
Unknown = otherwise
</code></pre>
<h3><a class="header" href="#canberemotecontrolled" id="canberemotecontrolled">CanBeRemoteControlled</a></h3>
<p><code>SupportsBufferedAudio</code> is set and <code>PINRequired</code> is not set</p>
<h3><a class="header" href="#state-changes" id="state-changes">State Changes</a></h3>
<p>Depending on the state of the device the mDNS record is changed to reflect
this. Primarily it is the <code>flags</code>, <code>gid</code>, <code>igl</code>, <code>gcgl</code>, <code>pgid</code> and <code>pgcgl</code>
fields that are changed.</p>
<h4><a class="header" href="#apple-tv-not-playing" id="apple-tv-not-playing">Apple TV not playing</a></h4>
<pre><code>flags=0x10644
gid=712F0759-5D44-41E7-AB67-FAB0AD39E165
igl=1
gcgl=1
</code></pre>
<h4><a class="header" href="#apple-tv-receiving-airplay-audio" id="apple-tv-receiving-airplay-audio">Apple TV receiving AirPlay audio</a></h4>
<pre><code>flags=0x30e44
gid=19F5D4B2-8A06-4792-923E-8AFA83913238
igl=0
gcgl=0
pgid=19F5D4B2-8A06-4792-923E-8AFA83913238
pgcgl=0
</code></pre>
<h4><a class="header" href="#apple-tv-receiving-airplay-video" id="apple-tv-receiving-airplay-video">Apple TV receiving AirPlay video</a></h4>
<pre><code>flags=0x30e44
gid=19F5D4B2-8A06-4792-923E-8AFA83913238
igl=0
gcgl=0
pgid=19F5D4B2-8A06-4792-923E-8AFA83913238
pgcgl=0
</code></pre>
<h4><a class="header" href="#apple-tv-receiving-airplay-screen" id="apple-tv-receiving-airplay-screen">Apple TV receiving AirPlay screen</a></h4>
<pre><code>flags=0x30644
gid=712F0759-5D44-41E7-AB67-FAB0AD39E165
igl=1
gcgl=1
</code></pre>
<h4><a class="header" href="#apple-tv-playing-local-media" id="apple-tv-playing-local-media">Apple TV playing local media</a></h4>
<pre><code>flags=0x10644
gid=FA69F5A2-5574-4E4D-A676-CA7F61A904A3
igl=1
gcgl=1
</code></pre>
<h1><a class="header" href="#features" id="features">Features</a></h1>
<table><thead><tr><th>bit</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>Video</td><td>video supported</td></tr>
<tr><td>1</td><td>Photo</td><td>photo supported</td></tr>
<tr><td>2</td><td>VideoFairPlay</td><td>video protected with FairPlay DRM</td></tr>
<tr><td>3</td><td>VideoVolumeControl</td><td>volume control supported for videos</td></tr>
<tr><td>4</td><td>VideoHTTPLiveStreams</td><td>http live streaming supported</td></tr>
<tr><td>5</td><td>Slideshow</td><td>slideshow supported</td></tr>
<tr><td>6</td><td></td><td></td></tr>
<tr><td>7</td><td>Screen</td><td>mirroring supported</td></tr>
<tr><td>8</td><td>ScreenRotate</td><td>screen rotation supported</td></tr>
<tr><td>9</td><td>Audio</td><td>audio supported</td></tr>
<tr><td>10</td><td></td><td></td></tr>
<tr><td>11</td><td>AudioRedundant</td><td>audio packet redundancy supported</td></tr>
<tr><td>12</td><td>FPSAPv2pt5_AES_GCM</td><td>FairPlay secure auth supported</td></tr>
<tr><td>13</td><td>PhotoCaching</td><td>photo preloading supported</td></tr>
<tr><td>14</td><td>Authentication4</td><td>Authentication type 4. FairPlay authentication</td></tr>
<tr><td>15</td><td>MetadataFeature1</td><td>bit 1 of MetadataFeatures. Artwork.</td></tr>
<tr><td>16</td><td>MetadataFeature2</td><td>bit 2 of MetadataFeatures. Progress.</td></tr>
<tr><td>17</td><td>MetadataFeature0</td><td>bit 0 of MetadataFeatures. Text.</td></tr>
<tr><td>18</td><td>AudioFormat1</td><td>support for audio format 1</td></tr>
<tr><td>19</td><td>AudioFormat2</td><td>support for audio format 2. This bit must be set for AirPlay 2 connection to work</td></tr>
<tr><td>20</td><td>AudioFormat3</td><td>support for audio format 3. This bit must be set for AirPlay 2 connection to work</td></tr>
<tr><td>21</td><td>AudioFormat4</td><td>support for audio format 4</td></tr>
<tr><td>22</td><td></td><td></td></tr>
<tr><td>23</td><td>Authentication1</td><td>Authentication type 1. RSA Authentication</td></tr>
<tr><td>24</td><td></td><td></td></tr>
<tr><td>25</td><td></td><td></td></tr>
<tr><td>26</td><td>HasUnifiedAdvertiserInfo</td><td></td></tr>
<tr><td>27</td><td>SupportsLegacyPairing</td><td></td></tr>
<tr><td>28</td><td></td><td></td></tr>
<tr><td>29</td><td></td><td></td></tr>
<tr><td>30</td><td>RAOP</td><td>RAOP is supported on this port. With this bit set your don't need the AirTunes service</td></tr>
<tr><td>31</td><td></td><td></td></tr>
<tr><td>32</td><td>IsCarPlay / SupportsVolume</td><td>Don’t read key from <code>pk</code> record it is known</td></tr>
<tr><td>33</td><td>SupportsAirPlayVideoPlayQueue</td><td></td></tr>
<tr><td>34</td><td>SupportsAirPlayFromCloud</td><td></td></tr>
<tr><td>35</td><td></td><td></td></tr>
<tr><td>36</td><td></td><td></td></tr>
<tr><td>37</td><td></td><td></td></tr>
<tr><td>38</td><td>SupportsCoreUtilsPairingAndEncryption</td><td><code>SupportsHKPairingAndAccessControl</code>, <code>SupportsSystemPairing</code> and <code>SupportsTransientPairing</code> implies <code>SupportsCoreUtilsPairingAndEncryption</code></td></tr>
<tr><td>39</td><td></td><td></td></tr>
<tr><td>40</td><td>SupportsBufferedAudio</td><td>Bit needed for device to show as supporting multi-room audio</td></tr>
<tr><td>41</td><td>SupportsPTP</td><td>Bit needed for device to show as supporting multi-room audio</td></tr>
<tr><td>42</td><td>SupportsScreenMultiCodec</td><td></td></tr>
<tr><td>43</td><td>SupportsSystemPairing</td><td></td></tr>
<tr><td>44</td><td></td><td></td></tr>
<tr><td>45</td><td></td><td></td></tr>
<tr><td>46</td><td>SupportsHKPairingAndAccessControl</td><td></td></tr>
<tr><td>47</td><td></td><td></td></tr>
<tr><td>48</td><td>SupportsTransientPairing</td><td><code>SupportsSystemPairing</code> implies <code>SupportsTransientPairing</code></td></tr>
<tr><td>49</td><td></td><td></td></tr>
<tr><td>50</td><td>MetadataFeature4</td><td>bit 4 of MetadataFeatures. binary plist.</td></tr>
<tr><td>51</td><td>SupportsUnifiedPairSetupAndMFi</td><td>Authentication type 8. MFi authentication</td></tr>
<tr><td>52</td><td>SupportsSetPeersExtendedMessage</td><td></td></tr>
</tbody></table>
<h1><a class="header" href="#status-flags" id="status-flags">Status Flags</a></h1>
<table><thead><tr><th>bit</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>Problem has been detected</td><td>Defined in CarPlay section of MFi spec. Not seen set anywhere</td></tr>
<tr><td>1</td><td>Device is not configured</td><td>Defined in CarPlay section of MFi spec. Not seen set anywhere</td></tr>
<tr><td>2</td><td>Audio cable is attached</td><td>Defined in CarPlay section of MFi spec. Seen on AppleTV, Denon AVR, HomePod, Airport Express</td></tr>
<tr><td>3</td><td>PINRequired</td><td></td></tr>
<tr><td>4</td><td>???</td><td>Not seen set anywhere</td></tr>
<tr><td>5</td><td>???</td><td>Not seen set anywhere</td></tr>
<tr><td>6</td><td>SupportsAirPlayFromCloud</td><td></td></tr>
<tr><td>7</td><td>PasswordRequired</td><td></td></tr>
<tr><td>8</td><td>???</td><td>Not seen set anywhere</td></tr>
<tr><td>9</td><td>OneTimePairingRequired</td><td></td></tr>
<tr><td>10</td><td>DeviceWasSetupForHKAccessControl</td><td></td></tr>
<tr><td>11</td><td>DeviceSupportsRelay</td><td>Shows in logs as relayable. When set iOS will connect to the device to get currently playing track.</td></tr>
<tr><td>12</td><td>SilentPrimary</td><td></td></tr>
<tr><td>13</td><td>TightSyncIsGroupLeader</td><td></td></tr>
<tr><td>14</td><td>TightSyncBuddyNotReachable</td><td></td></tr>
<tr><td>15</td><td>IsAppleMusicSubscriber</td><td>Shows in logs as music</td></tr>
<tr><td>16</td><td>CloudLibraryIsOn</td><td>Shows in logs as iCML</td></tr>
<tr><td>17</td><td>ReceiverSessionIsActive</td><td>Shows in logs as airplay-receiving. Set when Apple TV is receiving anything via AirPlay.</td></tr>
<tr><td>18</td><td>???</td><td>Not seen set anywhere</td></tr>
<tr><td>19</td><td>???</td><td>Not seen set anywhere</td></tr>
</tbody></table>
<h1><a class="header" href="#photos" id="photos">Photos</a></h1>
<p>Photos are <em>JPEG</em> data transmitted using a <code>PUT</code> request to the AirPlay
server. They can be displayed immediately, or cached for future use.</p>
<h1><a class="header" href="#http-requests" id="http-requests">HTTP requests</a></h1>
<h2><a class="header" href="#get-slideshow-features" id="get-slideshow-features">GET /slideshow-features</a></h2>
<p>A client can fetch the list of available transitions for slideshows.
Then it can let the user pick one, before starting a slideshow. The
<code>Accept-Language</code> header is used to specify in which language the
transition names should be.</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /slideshow-features HTTP/1.1
Accept-Language: English
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: cdda804c-33ae-4a0b-a5f2-f0e532fd5abd
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:41 GMT
Content-Type: text/x-apple-plist+xml
Content-Length: 6411
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;themes&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt;
      &lt;key&gt;key&lt;/key&gt;
      &lt;string&gt;Reflections&lt;/string&gt;
      &lt;key&gt;name&lt;/key&gt;
      &lt;string&gt;Reflections&lt;/string&gt;
    &lt;/dict&gt;
    ...
  &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h3><a class="header" href="#put-photo" id="put-photo">PUT /photo</a></h3>
<p>Send a JPEG picture to the server. The following headers are supported:</p>
<table><thead><tr><th>name</th><th>description</th></tr></thead><tbody>
<tr><td><code>X-Apple-AssetKey</code></td><td>UUID for the picture</td></tr>
<tr><td><code>X-Apple-Transition</code></td><td>transition that should be used to show the picture</td></tr>
<tr><td><code>X-Apple-AssetAction</code></td><td>specify a caching operation</td></tr>
</tbody></table>
<p><span class="ex">Example 1:</span> show a picture without any transition (for the first time)</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /photo HTTP/1.1
X-Apple-AssetKey: F92F9B91-954E-4D63-BB9A-EEC771ADE6E8
Content-Length: 462848
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c

&lt;JPEG DATA&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:42 GMT
Content-Length: 0
</code></pre>
</div>
<p><span class="ex">Example 2:</span> show a picture using the dissolve transition</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /photo HTTP/1.1
X-Apple-AssetKey: F92F9B91-954E-4D63-BB9A-EEC771ADE6E8
X-Apple-Transition: Dissolve
Content-Length: 462848
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c

&lt;JPEG DATA&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:42 GMT
Content-Length: 0
</code></pre>
</div>
<h3><a class="header" href="#put-slideshows1" id="put-slideshows1">PUT /slideshows/1</a></h3>
<p>Start or stop a slideshow session. When starting, slideshow settings
such as the slide duration and selected transition theme are
transmitted. The following parameters are sent in an XML property list:</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>settings.slideDuration</td><td>integer</td><td>slide duration in seconds</td></tr>
<tr><td>settings.theme</td><td>string</td><td>selected transition theme</td></tr>
<tr><td>state</td><td>string</td><td><code>playing</code> or <code>stopped</code></td></tr>
</tbody></table>
<p><span class="ex">Example:</span> send slideshow settings</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /slideshows/1 HTTP/1.1
Content-Type: text/x-apple-plist+xml
Content-Length: 366
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 98a7b246-8e00-49a6-8765-db57165f5b67
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;settings&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;slideDuration&lt;/key&gt;
    &lt;integer&gt;3&lt;/integer&gt;
    &lt;key&gt;theme&lt;/key&gt;
    &lt;string&gt;Classic&lt;/string&gt;
  &lt;/dict&gt;
  &lt;key&gt;state&lt;/key&gt;
  &lt;string&gt;playing&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 08 Mar 2012 16:30:01 GMT
Content-Type: text/x-apple-plist+xml
Content-Length: 181
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict/&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h3><a class="header" href="#post-stop" id="post-stop">POST /stop</a></h3>
<p>Stop a photo or slideshow session.</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /stop HTTP/1.1
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:55 GMT
Content-Length: 0
</code></pre>
</div>
<h1><a class="header" href="#events" id="events">Events</a></h1>
<h2><a class="header" href="#photo" id="photo">Photo</a></h2>
<p>This event notifies a client that a photo session has ended. Then the
server can safely disconnect.</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>category</td><td>string</td><td><code>photo</code></td></tr>
<tr><td>sessionID</td><td>integer</td><td>session ID</td></tr>
<tr><td>state</td><td>string</td><td><code>stopped</code></td></tr>
</tbody></table>
<p><span class="ex">Example:</span> stop photo session</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">POST /event HTTP/1.1
Content-Type: text/x-apple-plist+xml
Content-Length: 277
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;category&lt;/key&gt;
  &lt;string&gt;photo&lt;/string&gt;
  &lt;key&gt;sessionID&lt;/key&gt;
  &lt;integer&gt;38&lt;/integer&gt;
  &lt;key&gt;state&lt;/key&gt;
  &lt;string&gt;stopped&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Length: 0
</code></pre>
</div>
<h2><a class="header" href="#slideshow" id="slideshow">Slideshow</a></h2>
<p>Slideshow events are used to notify the server about the playback state.</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>category</td><td>string</td><td><code>slideshow</code></td></tr>
<tr><td>lastAssetID</td><td>integer</td><td>last asset ID</td></tr>
<tr><td>sessionID</td><td>integer</td><td>session ID</td></tr>
<tr><td>state</td><td>string</td><td><code>loading</code>, <code>playing</code> or <code>stopped</code></td></tr>
</tbody></table>
<p><span class="ex">Example:</span> slideshow is currently playing</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">POST /event HTTP/1.1
Content-Type: text/x-apple-plist+xml
Content-Length: 371
X-Apple-Session-ID: f1634b51-5cae-4384-ade5-54f4159a15f1
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;category&lt;/key&gt;
  &lt;string&gt;slideshow&lt;/string&gt;
  &lt;key&gt;lastAssetID&lt;/key&gt;
  &lt;integer&gt;5&lt;/integer&gt;
  &lt;key&gt;sessionID&lt;/key&gt;
  &lt;integer&gt;4&lt;/integer&gt;
  &lt;key&gt;state&lt;/key&gt;
  &lt;string&gt;playing&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Length: 0
</code></pre>
</div>
<h1><a class="header" href="#photo-caching" id="photo-caching">Photo Caching</a></h1>
<p>AirPlay supports preloading picture data to improve transition latency.
This works by preloading a few pictures (most likely the ones before and
after the current picture) just after displaying one.</p>
<p>Preloading is achieved using the <code>cacheOnly</code> asset action. Upon
receiving this request, a server stores the picture in its cache. Later,
a client can request the display of this picture using the
<code>displayCached</code> asset action and the same asset key. This is much faster
than a full picture upload because no additional data is transmitted.</p>
<p>When asked for a picture which is no longer in the cache, a server
replies with an HTTP 412 error code (Precondition Failed).</p>
<p><span class="ex">Example 1:</span> cache a picture for future display</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /photo HTTP/1.1
X-Apple-AssetAction: cacheOnly
X-Apple-AssetKey: B0DDE2C0-6FDD-48F8-9E5B-29CE0618DF5B
Content-Length: 462848
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c

&lt;JPEG DATA&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:45 GMT
Content-Length: 0
</code></pre>
</div>
<p><span class="ex">Example 2:</span> show a cached picture</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /photo HTTP/1.1
X-Apple-AssetAction: displayCached
X-Apple-AssetKey: B0DDE2C0-6FDD-48F8-9E5B-29CE0618DF5B
X-Apple-Transition: Dissolve
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:45 GMT
Content-Length: 0
</code></pre>
</div>
<h1><a class="header" href="#slideshows" id="slideshows">Slideshows</a></h1>
<p>Slideshows are using the reverse HTTP connection for asynchronous
loading of pictures. Three connections are performed in parallel. The
<code>X-Apple-Purpose</code> header is set to <code>slideshow</code>. A <code>GET</code> request to the
<code>/slideshows/1/assets/1</code> location is issued to fetch a new picture from
the AirPlay client. A binary property list with the following parameters
is expected as reply:</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>data</td><td>data</td><td>JPEG picture</td></tr>
<tr><td>info.id</td><td>integer</td><td>asset ID</td></tr>
<tr><td>info.key</td><td>integer</td><td>1</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> fetch a new picture</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">GET /slideshows/1/assets/1 HTTP/1.1
Content-Length: 0
Accept: application/x-apple-binary-plist
X-Apple-Session-ID: 98a7b246-8e00-49a6-8765-db57165f5b67
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/x-apple-binary-plist
Content-Length: 58932

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;data&lt;/key&gt;
  &lt;data&gt;
  ...
  &lt;/data&gt;
  &lt;key&gt;info&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;id&lt;/key&gt;
    &lt;integer&gt;1&lt;/integer&gt;
    &lt;key&gt;key&lt;/key&gt;
    &lt;string&gt;1&lt;/string&gt;
  &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h1><a class="header" href="#video" id="video">Video</a></h1>
<p>In order to play a video on an AirPlay server, HTTP requests are used to
send a video URL, perform scrubbing, change the playback rate and update
the timeline.</p>
<h1><a class="header" href="#http-requests-1" id="http-requests-1">HTTP requests</a></h1>
<h2><a class="header" href="#get-server-info" id="get-server-info">GET /server-info</a></h2>
<p>Fetch general informations about the AirPlay server. These informations
are returned as an XML property list, with the following properties:</p>
<table><thead><tr><th>key</th><th>type</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>deviceid</td><td>string</td><td>58:55:CA:1A:E2:88</td><td>MAC address</td></tr>
<tr><td>features</td><td>integer</td><td>14839</td><td>0x39f7</td></tr>
<tr><td>model</td><td>string</td><td>AppleTV2,1</td><td>device model</td></tr>
<tr><td>protovers</td><td>string</td><td>1.0</td><td>protocol version</td></tr>
<tr><td>srcvers</td><td>string</td><td>120.2</td><td>server version</td></tr>
</tbody></table>
<p>The <code>model</code>, <code>deviceid</code>, <code>srcvers</code> and <code>features</code> properties are the
same as broadcasted by the mDNS AirPlay service.</p>
<p><span class="ex">Example:</span> fetch server informations</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /server-info HTTP/1.1
X-Apple-Device-ID: 0xdc2b61a0ce79
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 1bd6ceeb-fffd-456c-a09c-996053a7a08c
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Thu, 23 Feb 2012 17:33:41 GMT
Content-Type: text/x-apple-plist+xml
Content-Length: 427
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;deviceid&lt;/key&gt;
  &lt;string&gt;58:55:CA:1A:E2:88&lt;/string&gt;
  &lt;key&gt;features&lt;/key&gt;
  &lt;integer&gt;14839&lt;/integer&gt;
  &lt;key&gt;model&lt;/key&gt;
  &lt;string&gt;AppleTV2,1&lt;/string&gt;
  &lt;key&gt;protovers&lt;/key&gt;
  &lt;string&gt;1.0&lt;/string&gt;
  &lt;key&gt;srcvers&lt;/key&gt;
  &lt;string&gt;120.2&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h2><a class="header" href="#post-play" id="post-play">POST /play</a></h2>
<p>Start video playback. The body contains the following parameters:</p>
<table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>Content-Location</td><td>URL</td><td>URL for the video</td></tr>
<tr><td>Start-Position</td><td>float</td><td>starting position between 0 and 1</td></tr>
</tbody></table>
<p>MP4 movies are supported using progressive download. [HTTP Live Streaming]
might be supported as well, as indicated by the <code>VideoHTTPLiveStreams</code>
feature flag. The relative starting position, a float value between 0
(beginning) and 1 (end) is used to start playing a video at the exact same
position as it was on the client.</p>
<p>A binary property list can also be used instead of text parameters, with
content type <code>application/x-apple-binary-plist</code>.</p>
<p><span class="ex">Example 1:</span> video playback from iTunes</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /play HTTP/1.1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Content-Length: 163
Content-Type: text/parameters

Content-Location: http://192.168.1.18:3689/airplay.mp4?database-spec='dmap.persistentid:0x63b5e5c0c201542e'&amp;item-spec='dmap.itemid:0x21d'
Start-Position: 0.174051
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 18:08:25 GMT
Content-Length: 0
</code></pre>
</div>
<p><span class="ex">Example 2:</span> video playback from iPhone</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /play HTTP/1.1
X-Transmit-Date: 2012-03-16T14:20:39.656533Z
Content-Type: application/x-apple-binary-plist
Content-Length: 491
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 368e90a4-5de6-4196-9e58-9917bdd4ffd7

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;Content-Location&lt;/key&gt;
  &lt;string&gt;http://redirector.c.youtube.com/videoplayback?...&lt;/string&gt;
  &lt;key&gt;Start-Position&lt;/key&gt;
  &lt;real&gt;0.024613151326775551&lt;/real&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
</code></pre>
</div>
<h2><a class="header" href="#post-scrub" id="post-scrub">POST /scrub</a></h2>
<p>Seek at an arbitrary location in the video. The <code>position</code> argument is a
float value representing the location in seconds.</p>
<p><span class="ex">Example:</span> seek to about 20 seconds</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /scrub?position=20.097000 HTTP/1.1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Content-Length: 0
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 18:08:42 GMT
Content-Length: 0
</code></pre>
</div>
<h2><a class="header" href="#post-rate" id="post-rate">POST /rate</a></h2>
<p>Change the playback rate. The <code>value</code> argument is a float value
representing the playback rate: 0 is paused, 1 is playing at the normal
speed.</p>
<p><span class="ex">Example:</span> pause playback</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /rate?value=0.000000 HTTP/1.1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Content-Length: 0
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 18:08:37 GMT
Content-Length: 0
</code></pre>
</div>
<h2><a class="header" href="#post-stop-1" id="post-stop-1">POST /stop</a></h2>
<p>Stop playback.</p>
<p><span class="ex">Example:</span> stop playback</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /stop HTTP/1.1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Content-Length: 0
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 18:09:06 GMT
Content-Length: 0
</code></pre>
</div>
<h2><a class="header" href="#get-scrub" id="get-scrub">GET /scrub</a></h2>
<p>Retrieve the current playback position. This can be called repeatedly to
update a timeline on the client. The following parameters are returned:</p>
<table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>duration</td><td>float</td><td>duration in seconds</td></tr>
<tr><td>position</td><td>float</td><td>position in seconds</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> fetch current playback progress</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /scrub HTTP/1.1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Content-Length: 0
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 18:08:31 GMT
Content-Type: text/parameters
Content-Length: 40

duration: 83.124794
position: 14.467000
</code></pre>
</div>
<h2><a class="header" href="#get-playback-info" id="get-playback-info">GET /playback-info</a></h2>
<p>Retrieve playback informations such as position, duration, rate,
buffering status and more. An XML property list is returned with the
following parameters:</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>duration</td><td>real</td><td>playback duration in seconds</td></tr>
<tr><td>position</td><td>real</td><td>playback position in seconds</td></tr>
<tr><td>rate</td><td>real</td><td>playback rate</td></tr>
<tr><td>readyToPlay</td><td>boolean</td><td>ready to play</td></tr>
<tr><td>playbackBufferEmpty</td><td>boolean</td><td>buffer empty</td></tr>
<tr><td>playbackBufferFull</td><td>boolean</td><td>buffer full</td></tr>
<tr><td>playbackLikelyToKeepUp</td><td>boolean</td><td>playback likely to keep up</td></tr>
<tr><td>loadedTimeRanges</td><td>array</td><td>array of loaded time ranges</td></tr>
<tr><td>seekableTimeRanges</td><td>array</td><td>array of seekable time ranges</td></tr>
</tbody></table>
<p>Ranges are defined as dictionaries with the following keys:</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>start</td><td>real</td><td>range start time in seconds</td></tr>
<tr><td>duration</td><td>real</td><td>range duration in seconds</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> get playback info</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /playback-info HTTP/1.1
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 24b3fd94-1b6d-42b1-89a3-47108bfbac89
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Fri, 16 Mar 2012 15:31:42 GMT
Content-Type: text/x-apple-plist+xml
Content-Length: 801
X-Transmit-Date: 2012-03-16T15:31:42.607066Z
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;duration&lt;/key&gt;&lt;real&gt;1801&lt;/real&gt;
  &lt;key&gt;loadedTimeRanges&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt;
      &lt;key&gt;duration&lt;/key&gt; &lt;real&gt;51.541130402&lt;/real&gt;
      &lt;key&gt;start&lt;/key&gt; &lt;real&gt;18.118717650000001&lt;/real&gt;
    &lt;/dict&gt;
  &lt;/array&gt;
  &lt;key&gt;playbackBufferEmpty&lt;/key&gt; &lt;true/&gt;
  &lt;key&gt;playbackBufferFull&lt;/key&gt; &lt;false/&gt;
  &lt;key&gt;playbackLikelyToKeepUp&lt;/key&gt; &lt;true/&gt;
  &lt;key&gt;position&lt;/key&gt; &lt;real&gt;18.043869775000001&lt;/real&gt;
  &lt;key&gt;rate&lt;/key&gt; &lt;real&gt;1&lt;/real&gt;
  &lt;key&gt;readyToPlay&lt;/key&gt; &lt;true/&gt;
  &lt;key&gt;seekableTimeRanges&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt;
      &lt;key&gt;duration&lt;/key&gt;
      &lt;real&gt;1801&lt;/real&gt;
      &lt;key&gt;start&lt;/key&gt;
      &lt;real&gt;0.0&lt;/real&gt;
    &lt;/dict&gt;
  &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h2><a class="header" href="#put-setproperty" id="put-setproperty">PUT /setProperty</a></h2>
<p>Set playback property. The property name is sent as query argument. The
following properties are defined:</p>
<table><thead><tr><th>argument</th><th>description</th></tr></thead><tbody>
<tr><td>forwardEndTime</td><td>forward end time</td></tr>
<tr><td>reverseEndTime</td><td>reverse end time</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> set forward end time</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">PUT /setProperty?forwardEndTime HTTP/1.1
Content-Type: application/x-apple-binary-plist
Content-Length: 96
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 24b3fd94-1b6d-42b1-89a3-47108bfbac89

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;value&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;epoch&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
    &lt;key&gt;flags&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
    &lt;key&gt;timescale&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
    &lt;key&gt;value&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
  &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Fri, 16 Mar 2012 15:23:11 GMT
Content-Type: application/x-apple-binary-plist
Content-Length: 58

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;errorCode&lt;/key&gt;
  &lt;integer&gt;0&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h2><a class="header" href="#get-getproperty" id="get-getproperty">GET /getProperty</a></h2>
<p>Get playback property. The property name is sent as query argument. The
following properties are defined:</p>
<table><thead><tr><th>argument</th><th>description</th></tr></thead><tbody>
<tr><td>playbackAccessLog</td><td>playback access log</td></tr>
<tr><td>playbackErrorLog</td><td>playback error log</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> get playback access log</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /getProperty?playbackAccessLog HTTP/1.1
Content-Type: application/x-apple-binary-plist
Content-Length: 0
User-Agent: MediaControl/1.0
X-Apple-Session-ID: 24b3fd94-1b6d-42b1-89a3-47108bfbac89
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Fri, 16 Mar 2012 15:31:42 GMT
Content-Type: application/x-apple-binary-plist
Content-Length: 530

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;errorCode&lt;/key&gt;
  &lt;integer&gt;0&lt;/integer&gt;
  &lt;key&gt;value&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt;
      &lt;key&gt;bytes&lt;/key&gt; &lt;integer&gt;1818336&lt;/integer&gt;
      &lt;key&gt;c-duration-downloaded&lt;/key&gt; &lt;real&gt;70&lt;/real&gt;
      &lt;key&gt;c-duration-watched&lt;/key&gt; &lt;real&gt;18.154102027416229&lt;/real&gt;
      &lt;key&gt;c-frames-dropped&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
      &lt;key&gt;c-observed-bitrate&lt;/key&gt; &lt;real&gt;14598047.302367469&lt;/real&gt;
      &lt;key&gt;c-overdue&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
      &lt;key&gt;c-stalls&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
      &lt;key&gt;c-start-time&lt;/key&gt; &lt;real&gt;0.0&lt;/real&gt;
      &lt;key&gt;c-startup-time&lt;/key&gt; &lt;real&gt;0.27732497453689575&lt;/real&gt;
      &lt;key&gt;cs-guid&lt;/key&gt; &lt;string&gt;B475F105-78FD-4200-96BC-148BAB6DAC11&lt;/string&gt;
      &lt;key&gt;date&lt;/key&gt; &lt;date&gt;2012-03-16T15:31:24Z&lt;/date&gt;
      &lt;key&gt;s-ip&lt;/key&gt; &lt;string&gt;213.152.6.89&lt;/string&gt;
      &lt;key&gt;s-ip-changes&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt;
      &lt;key&gt;sc-count&lt;/key&gt; &lt;integer&gt;7&lt;/integer&gt;
      &lt;key&gt;uri&lt;/key&gt; &lt;string&gt;http://devimages.apple.com/iphone/samples/bipbop/gear1/prog_index.m3u8&lt;/string&gt;
    &lt;/dict&gt;
  &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h1><a class="header" href="#events-1" id="events-1">Events</a></h1>
<p>This event is used to send the playback state to the client:</p>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>category</td><td>string</td><td><code>video</code></td></tr>
<tr><td>sessionID</td><td>integer</td><td>session id</td></tr>
<tr><td>state</td><td>string</td><td><code>loading</code>, <code>playing</code>, <code>paused</code> or <code>stopped</code></td></tr>
</tbody></table>
<p><span class="ex">Example:</span> notify the client that video playback is paused</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">POST /event HTTP/1.1
Content-Type: application/x-apple-plist
Content-Length: 321
X-Apple-Session-ID: 00000000-0000-0000-0000-000000000000
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;category&lt;/key&gt;
  &lt;string&gt;video&lt;/string&gt;
  &lt;key&gt;sessionID&lt;/key&gt;
  &lt;integer&gt;13&lt;/integer&gt;
  &lt;key&gt;state&lt;/key&gt;
  &lt;string&gt;paused&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Length: 0
Date: Mon, 08 Mar 2012 18:07:43 GMT
</code></pre>
</div>
<h1><a class="header" href="#audio" id="audio">Audio</a></h1>
<p>Audio streaming is supported using the [RTSP] protocol.</p>
<h1><a class="header" href="#rtsp-requests" id="rtsp-requests">RTSP Requests</a></h1>
<h1><a class="header" href="#get-info" id="get-info">GET /info</a></h1>
<table><thead><tr><th>key</th><th>type</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>PTPInfo</td><td>string</td><td></td><td></td></tr>
<tr><td>build</td><td>string</td><td></td><td></td></tr>
<tr><td>deviceID</td><td>string</td><td>58:55:CA:1A:E2:88</td><td>MAC address</td></tr>
<tr><td>features</td><td>integer</td><td>14839</td><td><a href="audio/rtsp_requests/../../features.html">features</a> bits as decimal value</td></tr>
<tr><td>initialVolume</td><td>real</td><td></td><td></td></tr>
<tr><td>macAddress</td><td>string</td><td></td><td></td></tr>
<tr><td>firmwareBuildDate</td><td>string</td><td></td><td></td></tr>
<tr><td>firmwareRevision</td><td>string</td><td></td><td></td></tr>
<tr><td>keepAliveLowPower</td><td>boolean</td><td></td><td></td></tr>
<tr><td>keepAliveSendStatsAsBody</td><td>boolean</td><td></td><td></td></tr>
<tr><td>manufacturer</td><td>string</td><td></td><td></td></tr>
<tr><td>model</td><td>string</td><td>AppleTV2,1</td><td>device model</td></tr>
<tr><td>name</td><td>string</td><td></td><td></td></tr>
<tr><td>nameIsFactoryDefault</td><td>boolean</td><td></td><td></td></tr>
<tr><td>pi</td><td>string</td><td></td><td></td></tr>
<tr><td>pk</td><td>data</td><td></td><td></td></tr>
<tr><td>playbackCapabilities.supportsFPSSecureStop</td><td>boolean</td><td></td><td></td></tr>
<tr><td>playbackCapabilities.supportsUIForAudioOnlyContent</td><td>boolean</td><td></td><td></td></tr>
<tr><td>protocolVersion</td><td>string</td><td>1.0</td><td>protocol version</td></tr>
<tr><td>psi</td><td>string</td><td></td><td></td></tr>
<tr><td>senderAddress</td><td>string</td><td></td><td></td></tr>
<tr><td>sdk</td><td>string</td><td></td><td></td></tr>
<tr><td>sourceVersion</td><td>string</td><td>120.2</td><td>server version</td></tr>
<tr><td>statusFlags</td><td>integer</td><td>4</td><td><a href="audio/rtsp_requests/../../status_flags.html">status flags</a> as decimal value</td></tr>
<tr><td>txtAirPlay</td><td>data</td><td>...</td><td>raw TXT record from <a href="audio/rtsp_requests/../../service_discovery.html">AirPlay service</a> mDNS record</td></tr>
<tr><td>txtRAOP</td><td>data</td><td>...</td><td>raw TXT record from <a href="audio/rtsp_requests/../../service_discovery.html">AirTunes service</a> mDNS record</td></tr>
<tr><td>volumeControlType</td><td>integer</td><td></td><td></td></tr>
<tr><td>vv</td><td>integer</td><td></td><td></td></tr>
</tbody></table>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /info RTSP/1.0
X-Apple-ProtocolVersion: 1
CSeq: 0
DACP-ID: ADA239F4521B1802
Active-Remote: 753030410
User-Agent: AirPlay/380.10.1
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Content-Length: 927
Content-Type: application/x-apple-binary-plist
Server: AirTunes/366.0
CSeq: 0

&lt;BINARY PLIST DATA&gt;
</code></pre>
<div class="plist">
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
	&lt;key&gt;PTPInfo&lt;/key&gt;
	&lt;string&gt;OpenAVNU ArtAndLogic-aPTP-changes 1.0&lt;/string&gt;
	&lt;key&gt;build&lt;/key&gt;
	&lt;string&gt;17.0&lt;/string&gt;
	&lt;key&gt;deviceID&lt;/key&gt;
	&lt;string&gt;00:05:CD:D4:42:96&lt;/string&gt;
	&lt;key&gt;features&lt;/key&gt;
	&lt;integer&gt;496155769145856&lt;/integer&gt;
	&lt;key&gt;firmwareBuildDate&lt;/key&gt;
	&lt;string&gt;Jan 30 2019&lt;/string&gt;
	&lt;key&gt;firmwareRevision&lt;/key&gt;
	&lt;string&gt;1.505.130&lt;/string&gt;
	&lt;key&gt;keepAliveLowPower&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;keepAliveSendStatsAsBody&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;manufacturer&lt;/key&gt;
	&lt;string&gt;Sound United&lt;/string&gt;
	&lt;key&gt;model&lt;/key&gt;
	&lt;string&gt;AVR-X3500H&lt;/string&gt;
	&lt;key&gt;name&lt;/key&gt;
	&lt;string&gt;Daemon&lt;/string&gt;
	&lt;key&gt;nameIsFactoryDefault&lt;/key&gt;
	&lt;false/&gt;
	&lt;key&gt;pi&lt;/key&gt;
	&lt;string&gt;650c20ee-842c-4c01-80ed-22b7fb239881&lt;/string&gt;
	&lt;key&gt;protocolVersion&lt;/key&gt;
	&lt;string&gt;1.1&lt;/string&gt;
	&lt;key&gt;sdk&lt;/key&gt;
	&lt;string&gt;AirPlay;2.0.2&lt;/string&gt;
	&lt;key&gt;sourceVersion&lt;/key&gt;
	&lt;string&gt;366.0&lt;/string&gt;
	&lt;key&gt;statusFlags&lt;/key&gt;
	&lt;integer&gt;4&lt;/integer&gt;
	&lt;key&gt;txtAirPlay&lt;/key&gt;
	&lt;data&gt;
	BWFjbD0wGmRldmljZWlkPTAwOjA1OkNEOkQ0OjQyOjk2G2ZlYXR1cmVzPTB4NDQ1RjhB
	MDAsMHgxQzM0MAdyc2Y9MHgwEGZ2PXAyMC4xLjUwNS4xMzAJZmxhZ3M9MHg0EG1vZGVs
	PUFWUi1YMzUwMEgZbWFudWZhY3R1cmVyPVNvdW5kIFVuaXRlZBtzZXJpYWxOdW1iZXI9
	QkJXMzYxODEyMTIzNjQNcHJvdG92ZXJzPTEuMQ1zcmN2ZXJzPTM2Ni4wJ3BpPTY1MGMy
	MGVlLTg0MmMtNGMwMS04MGVkLTIyYjdmYjIzOTg4MShnaWQ9NjUwYzIwZWUtODQyYy00
	YzAxLTgwZWQtMjJiN2ZiMjM5ODgxBmdjZ2w9MENwaz0wYWNkN2Q2MWIyODRjMGFmNzFj
	N2VmNGY3ZWE2NDRkZGRlYzIzOGVmMjdjM2MwYWQzZDVkM2JiOWM4YjMxZThm
	&lt;/data&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<pre><code class="language-base64">YnBsaXN0MDDfEBIBAgMEBQYHCAkKCwwNDg8QERITFBUWFxgZGhcbHB0eHyAh
IiNTc2RrUnBpXxAQZmlybXdhcmVSZXZpc2lvblxtYW51ZmFjdHVyZXJfEBFr
ZWVwQWxpdmVMb3dQb3dlcl8QEWZpcm13YXJlQnVpbGREYXRlVW1vZGVsXxAU
bmFtZUlzRmFjdG9yeURlZmF1bHRfEBhrZWVwQWxpdmVTZW5kU3RhdHNBc0Jv
ZHlbc3RhdHVzRmxhZ3NYZGV2aWNlSURVYnVpbGRadHh0QWlyUGxheVdQVFBJ
bmZvXxAPcHJvdG9jb2xWZXJzaW9uXXNvdXJjZVZlcnNpb25YZmVhdHVyZXNU
bmFtZV1BaXJQbGF5OzIuMC4yXxAkNjUwYzIwZWUtODQyYy00YzAxLTgwZWQt
MjJiN2ZiMjM5ODgxWTEuNTA1LjEzMFxTb3VuZCBVbml0ZWQJW0phbiAzMCAy
MDE5WkFWUi1YMzUwMEgIEARfEBEwMDowNTpDRDpENDo0Mjo5NlQxNy4wTxEB
XwVhY2w9MBpkZXZpY2VpZD0wMDowNTpDRDpENDo0Mjo5NhtmZWF0dXJlcz0w
eDQ0NUY4QTAwLDB4MUMzNDAHcnNmPTB4MBBmdj1wMjAuMS41MDUuMTMwCWZs
YWdzPTB4NBBtb2RlbD1BVlItWDM1MDBIGW1hbnVmYWN0dXJlcj1Tb3VuZCBV
bml0ZWQbc2VyaWFsTnVtYmVyPUJCVzM2MTgxMjEyMzY0DXByb3RvdmVycz0x
LjENc3JjdmVycz0zNjYuMCdwaT02NTBjMjBlZS04NDJjLTRjMDEtODBlZC0y
MmI3ZmIyMzk4ODEoZ2lkPTY1MGMyMGVlLTg0MmMtNGMwMS04MGVkLTIyYjdm
YjIzOTg4MQZnY2dsPTBDcGs9MGFjZDdkNjFiMjg0YzBhZjcxYzdlZjRmN2Vh
NjQ0ZGRkZWMyMzhlZjI3YzNjMGFkM2Q1ZDNiYjljOGIzMWU4Zl8QJU9wZW5B
Vk5VIEFydEFuZExvZ2ljLWFQVFAtY2hhbmdlcyAxLjBTMS4xVTM2Ni4wEwAB
w0BEX4oAVkRhZW1vbgAIAC8AMwA2AEkAVgBqAH4AhACbALYAwgDLANEA3ADk
APYBBAENARIBIAFHAVEBXgFfAWsBdgF3AXkBjQGSAvUDHQMhAycDMAAAAAAA
AAIBAAAAAAAAACQAAAAAAAAAAAAAAAAAAAM3
</code></pre>
</div>
</div>
<h1><a class="header" href="#post-pair-setup" id="post-pair-setup">POST /pair-setup</a></h1>
<h1><a class="header" href="#post-pair-verify" id="post-pair-verify">POST /pair-verify</a></h1>
<h1><a class="header" href="#post-fp-setup" id="post-fp-setup">POST /fp-setup</a></h1>
<h1><a class="header" href="#post-auth-setup" id="post-auth-setup">POST /auth-setup</a></h1>
<p>In case MFi authentication is supported (HasUnifiedAdvertiserInfo), it can be raised either with a auth-setup challenge or included in the pairing process if supported (SupportsUnifiedPairSetupAndMFi).
This section describes the first option.</p>
<p>Note that even if it is a server authentication (so that clients ensure MFi authenticity), with Airplay2 devices this step cannot be ignored from a client implementation point of view. Meaning, even if the
authentication/signature is not checked on client side, the request has to be done, otherwise the server will deny further requests</p>
<p>The challenge process is the following:</p>
<ol>
<li>Generation of Curve25119 key pairs on both client and server</li>
<li>Client send its public key to server</li>
<li>Server append its public key with client's one, this will be the message to sign. It then gets the signature from Apple authentication IC. RSA-1024 is used, with SHA-1 hash algorithm.</li>
<li>Signature is encrypted with AES-128 in Counter mode with:
<ul>
<li>Key = 16 first bytes of <code>SHA1(&lt;7:AES-KEY&gt;&lt;32:Curve25119 Shared key&gt;)</code> </li>
<li>IV  = 16 first bytes of <code>SHA1(&lt;6:AES-IV&gt;&lt;32:Curve25119 Shared key&gt;)</code> </li>
</ul>
</li>
<li>Server respond with it's Curve25119 public key, the encrypted signature and the certificate.</li>
</ol>
<p>A pair-setup request body has the following format:</p>
<p><code>&lt;1:Encryption Type&gt;</code><br />
<code>&lt;32:Client’s Curve25119 public key&gt;</code></p>
<p>Where encryption type is:</p>
<table><thead><tr><th>value</th><th>type</th></tr></thead><tbody>
<tr><td>0x00</td><td>Invalid</td></tr>
<tr><td>0x01</td><td>Unencrypted</td></tr>
<tr><td>0x10</td><td>MFi-SAP-encrypted AES key.</td></tr>
</tbody></table>
<p>A pair-setup response body has the following format:</p>
<pre><code>&lt;32:Server’s Curve25119 public key&gt;  
&lt;4:Certificate length (int32be)&gt;  
&lt;n:PKCS#7 DER encoded MFiCertificate&gt;  
&lt;4:Signature length (int32be)&gt;  
&lt;n:Signature&gt;
</code></pre>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /auth-setup RTSP/1.0
Content-Type: application/octet-stream
Content-Length: 33
CSeq: 1
User-Agent: iTunes/7.6.2 (Windows; N;)
Client-Instance: 050748FD6F0853AC
DACP-ID: 124D322761E2EC16
Client-instance-identifier: 5743a6b4-e835-412f-9894-14011e386cf2

&lt;BINARY_REQUEST&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Content-Length: 1076
Content-Type: application/octet-stream
Server: AirTunes/366.0
CSeq: 1

&lt;BINARY_RESPONSE&gt;
</code></pre>
</div>
<h1><a class="header" href="#options" id="options">OPTIONS</a></h1>
<p>The <code>OPTIONS</code> request asks the RTSP server for its supported methods.
Apple TV supports the following methods: <code>ANNOUNCE</code>, <code>SETUP</code>, <code>RECORD</code>,
<code>PAUSE</code>, <code>FLUSH</code>, <code>TEARDOWN</code>, <code>OPTIONS</code>, <code>GET_PARAMETER</code>, <code>SET_PARAMETER</code>,
<code>POST</code> and <code>GET</code>.</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">OPTIONS * RTSP/1.0
CSeq: 3
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Public: ANNOUNCE, SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS,
GET_PARAMETER, SET_PARAMETER, POST, GET
Server: AirTunes/130.14
CSeq: 3
</code></pre>
</div>
<h1><a class="header" href="#announce" id="announce">ANNOUNCE</a></h1>
<p>The <code>ANNOUNCE</code> request tells the RTSP server about stream properties using
[SDP]. Codec informations and encryption keys are of particular interest.</p>
<p><span class="ex">Example 1:</span> <code>ANNOUNCE</code> for <em>Apple Lossless</em> audio from iTunes</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">ANNOUNCE rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 3
Content-Type: application/sdp
Content-Length: 348
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575

v=0
o=iTunes 3413821438 0 IN IP4 fe80::217:f2ff:fe0f:e0f6
s=iTunes
c=IN IP4 fe80::5a55:caff:fe1a:e187
t=0 0
m=audio 0 RTP/AVP 96
a=rtpmap:96 AppleLossless
a=fmtp:96 352 0 16 40 10 14 2 255 0 0 44100
a=fpaeskey:RlBMWQECAQAAAAA8AAAAAPFOnNe+zWb5/n4L5KZkE2AAAAAQlDx69reTdwHF9LaNmhiRURTAbcL4brYAceAkZ49YirXm62N4
a=aesiv:5b+YZi9Ikb845BmNhaVo+Q
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 3
</code></pre>
</div>
<p><span class="ex">Example 2:</span> <code>ANNOUNCE</code> for <em>AAC</em> audio from an iOS
device</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">ANNOUNCE rtsp://192.168.1.45/2699324803567405959 RTSP/1.0
X-Apple-Device-ID: 0xa4d1d2800b68
CSeq: 16
DACP-ID: 14413BE4996FEA4D
Active-Remote: 2543110914
Content-Type: application/sdp
Content-Length: 331

v=0
o=AirTunes 2699324803567405959 0 IN IP4 192.168.1.5
s=AirTunes
c=IN IP4 192.168.1.5
t=0 0
m=audio 0 RTP/AVP 96
a=rtpmap:96 mpeg4-generic/44100/2
a=fmtp:96
a=fpaeskey:RlBMWQECAQAAAAA8AAAAAOG6c4aMdLkXAX+lbjp7EhgAAAAQeX5uqGyYkBmJX+gd5ANEr+amI8urqFmvcNo87pR0BXGJ4eLf
a=aesiv:VZTaHn4wSJ84Jjzlb94m0Q==
a=min-latency:11025
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 16
</code></pre>
</div>
<p><span class="ex">Example 3:</span> <code>ANNOUNCE</code> for <em>AAC-ELD</em> audio and <em>H.264</em>
video from an iOS device</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">ANNOUNCE rtsp://192.168.1.45/846700446248110360 RTSP/1.0
X-Apple-Device-ID: 0xa4d1d2800b68
CSeq: 27
DACP-ID: 14413BE4996FEA4D
Active-Remote: 2543110914
Content-Type: application/sdp
Content-Length: 415

v=0
o=AirTunes 846700446248110360 0 IN IP4 192.168.1.5
s=AirTunes
c=IN IP4 192.168.1.5
t=0 0
m=audio 0 RTP/AVP 96
a=rtpmap:96 mpeg4-generic/44100/2
a=fmtp:96 mode=AAC-eld; constantDuration=480
a=fpaeskey:RlBMWQECAQAAAAA8AAAAAKKp+t27A+686xfviEphhw8AAAAQE/3LSqv9MHgnEKxkbKh1buE9+ylKg0YuqcyAC7fT0EqJNtdq
a=aesiv:i/a3nUKYNDSIPP2fC+UKGQ==
a=min-latency:4410
m=video 0 RTP/AVP 97
a=rtpmap:97 H264
a=fmtp:97
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 27
</code></pre>
</div>
<h1><a class="header" href="#setup" id="setup">SETUP</a></h1>
<p>The <code>SETUP</code> request initializes a record session. It sends all the
necessary transport informations. Three UDP channels are setup:</p>
<table><thead><tr><th>channel</th><th>description</th></tr></thead><tbody>
<tr><td>server</td><td>audio data</td></tr>
<tr><td>control</td><td>sync and retransmit requests</td></tr>
<tr><td>timing</td><td>master clock sync</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> setup a record session</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">SETUP rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 4
Transport: RTP/AVP/UDP;unicast;interleaved=0-1;mode=record;control_port=6001;timing_port=6002
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Transport: RTP/AVP/UDP;unicast;mode=record;server_port=53561;control_port=63379;timing_port=50607
Session: 1
Audio-Jack-Status: connected
Server: AirTunes/130.14
CSeq: 4
</code></pre>
</div>
<h1><a class="header" href="#setpeers" id="setpeers">SETPEERS</a></h1>
<h1><a class="header" href="#post-command" id="post-command">POST /command</a></h1>
<h1><a class="header" href="#post-feedback" id="post-feedback">POST /feedback</a></h1>
<h1><a class="header" href="#post-audiomode" id="post-audiomode">POST /audioMode</a></h1>
<h1><a class="header" href="#record" id="record">RECORD</a></h1>
<p>The <code>RECORD</code> request starts the audio streaming. The <code>RTP-Info</code> header
contains the following parameters:</p>
<table><thead><tr><th>name</th><th>size</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>16-bit</td><td>initial RTP sequence number</td></tr>
<tr><td>rtptime</td><td>32-bit</td><td>initial RTP timestamp</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> start audio stream</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">RECORD rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 5
Session: 1
Range: npt=0-
RTP-Info: seq=20857;rtptime=1146549156
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Audio-Latency: 2205
Server: AirTunes/130.14
CSeq: 5
</code></pre>
</div>
<h1><a class="header" href="#flush" id="flush">FLUSH</a></h1>
<p>The <code>FLUSH</code> request stops the streaming.</p>
<p><span class="ex">Example:</span> pause the audio stream</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">FLUSH rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 31
Session: 1
RTP-Info: seq=25009;rtptime=1148010660
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
RTP-Info: rtptime=1147914212
Server: AirTunes/130.14
CSeq: 31
</code></pre>
</div>
<h1><a class="header" href="#flushbuffered" id="flushbuffered">FLUSHBUFFERED</a></h1>
<p>Applies to: Airplay2</p>
<p>The <code>FLUSHBUFFERED</code> is used to request the flush of the buffer, in a buffered audio usage context (see SupportsBufferedAudio feature)</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">FLUSHBUFFERED rtsp://192.168.128.227/4361780817803627124 RTSP/1.0
Content-Length: 87
Content-Type: application/x-apple-binary-plist
CSeq: 12
DACP-ID: C0EF6588CF6D70AC
Active-Remote: 1641836738
User-Agent: AirPlay/387.2

&lt;binary plist&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/366.0
CSeq: 12
</code></pre>
</div>
<p>binary plist includes the RTP sequence &amp; timestamp to flush up to:</p>
<pre><code>{'flushUntilSeq': 15363674, 'flushUntilTS': 239565966}
</code></pre>
<p>and optionally, the RTP sequence &amp; timestamp to flush from:</p>
<pre><code>{'flushFromSeq': 15380707,
 'flushFromTS': 1554930586,
 'flushUntilSeq': 15381800,
 'flushUntilTS': 1556050842}
</code></pre>
<h1><a class="header" href="#teardown" id="teardown">TEARDOWN</a></h1>
<p>The <code>TEARDOWN</code> request ends the RTSP session.</p>
<p><span class="ex">Example:</span> close session 1</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">TEARDOWN rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 32
Session: 1
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 32
</code></pre>
</div>
<h1><a class="header" href="#rtp-streams" id="rtp-streams">RTP Streams</a></h1>
<p>Audio packets are fully RTP compliant. Control and timing packets,
however, do not seem to be fully compliant with the RTP standard.</p>
<p>The following payload types are defined:</p>
<table><thead><tr><th>payload type</th><th>port</th><th>description</th></tr></thead><tbody>
<tr><td>82</td><td>timing_port</td><td>timing request</td></tr>
<tr><td>83</td><td>timing_port</td><td>timing reply</td></tr>
<tr><td>84</td><td>control_port</td><td>time sync</td></tr>
<tr><td>85</td><td>control_port</td><td>retransmit request</td></tr>
<tr><td>86</td><td>control_port</td><td>retransmit reply</td></tr>
<tr><td>96</td><td>server_port</td><td>audio data</td></tr>
</tbody></table>
<h2><a class="header" href="#audio-packets" id="audio-packets">Audio packets</a></h2>
<p>Audio data is sent using the <code>DynamicRTP-Type-96</code> payload type. The <code>Marker</code>
bit is set on the first packet sent after <code>RECORD</code> or <code>FLUSH</code> requests. The RTP
payload contains optionally encrypted audio data.</p>
<p><span class="ex">Example:</span> encrypted audio packet</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-hex">0000   80 e0 b1 91 f7 79 16 c2 e8 bb 6b 2c bb 5c 8e 51
0010   aa 7c d2 96 00 c3 fd 60 eb ae 6e 41 31 38 fe ae
....
03e0   cb 1c 73 bf e7 05 93 30 fa 85 7f 32 77 8d a8 97
03f0   a0 c7 c8 78 7b e5 81 a1 4f b4 3e a3 43 db 7c

Real-Time Transport Protocol
10.. .... = Version: RFC 1889 Version (2)
..0. .... = Padding: False
...0 .... = Extension: False
.... 0000 = Contributing source identifiers count: 0
1... .... = Marker: True
Payload type: DynamicRTP-Type-96 (96)
Sequence number: 45457
Timestamp: 4151908034
Synchronization Source identifier: 0xe8bb6b2c (3904596780)
Payload: bb5c8e51aa7cd29600c3fd60ebae6e413138feae909b44f1...
</code></pre>
</div>
<h2><a class="header" href="#sync-packets" id="sync-packets">Sync packets</a></h2>
<p>Sync packets are sent once per second to the control port. They are used to
correlate the RTP timestamps currently used in the audio stream to the NTP time
used for clock synchronization. Payload type is 84, the <code>Marker</code> bit is always
set and the <code>Extension</code> bit is set on the first packet after <code>RECORD</code> or
<code>FLUSH</code> requests. The <code>SSRC</code> field is not included in the RTP header.</p>
<table><thead><tr><th>bytes</th><th>description</th></tr></thead><tbody>
<tr><td>8</td><td>RTP header without <code>SSRC</code></td></tr>
<tr><td>8</td><td>current NTP time</td></tr>
<tr><td>4</td><td>RTP timestamp for the next audio packet</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> sync packet</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-hex">0000   80 d4 00 04 c7 cd 11 a8 83 ab 1c 49 2f e4 22 e2
0010   c7 ce 3f 1f

Real-Time Transport Protocol
10.. .... = Version: RFC 1889 Version (2)
..0. .... = Padding: False
...0 .... = Extension: False
.... 0000 = Contributing source identifiers count: 0
1... .... = Marker: True
Payload type: Unassigned (84)
Sequence number: 4
Timestamp: 3352105384
Synchronization Source identifier: 0x83ab1c49 (2209029193)
Payload: 2fe422e2c7ce3f1f
</code></pre>
</div>
<h2><a class="header" href="#retransmit-packets" id="retransmit-packets">Retransmit packets</a></h2>
<p>AirTunes supports resending audio packets which have been lost. Payload
type is 85 for retransmit queries, the <code>Marker</code> bit is always set and the
<code>SSRC</code> field is not included in the RTP header.</p>
<table><thead><tr><th>bytes</th><th>description</th></tr></thead><tbody>
<tr><td>8</td><td>RTP header without <code>SSRC</code></td></tr>
<tr><td>2</td><td>sequence number for the first lost packet</td></tr>
<tr><td>2</td><td>number of lost packets</td></tr>
</tbody></table>
<p>Retransmit replies have payload type 86, with a full audio RTP packet
after the sequence number.</p>
<h2><a class="header" href="#timing-packets" id="timing-packets">Timing packets</a></h2>
<p>Timing packets are used to synchronize a master clock for audio. This is
useful for clock recovery and precise synchronization of several devices
playing the same audio stream.</p>
<p>Timing packets are sent at 3 second intervals. They always have the
<code>Marker</code> bit set, and payload type 82 for queries and 83 for replies.
The <code>SSRC</code> field is not included in the RTP header, so it takes only 8
bytes, followed by three <em>NTP</em> timestamps:</p>
<table><thead><tr><th>bytes</th><th>description</th></tr></thead><tbody>
<tr><td>8</td><td>RTP header without <code>SSRC</code></td></tr>
<tr><td>8</td><td>origin timestamp</td></tr>
<tr><td>8</td><td>receive timestamp</td></tr>
<tr><td>8</td><td>transmit timestamp</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> timing query/reply</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-hex">0000   80 d2 00 07 00 00 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 83 c1 17 cc af ba 9b 32

Real-Time Transport Protocol
10.. .... = Version: RFC 1889 Version (2)
..0. .... = Padding: False
...0 .... = Extension: False
.... 0000 = Contributing source identifiers count: 0
1... .... = Marker: True
Payload type: Unassigned (82)
Sequence number: 7
Timestamp: 0
Synchronization Source identifier: 0x00000000 (0)
Payload: 00000000000000000000000083c117ccafba9b32
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-hex">0000   80 d3 00 07 00 00 00 00 83 c1 17 cc af ba 9b 32
0010   83 c1 17 cc b0 12 ce b6 83 c1 17 cc b0 14 10 47

Real-Time Transport Protocol
10.. .... = Version: RFC 1889 Version (2)
..0. .... = Padding: False
...0 .... = Extension: False
.... 0000 = Contributing source identifiers count: 0
1... .... = Marker: True
Payload type: Unassigned (83)
Sequence number: 7
Timestamp: 0
Synchronization Source identifier: 0x83c117cc (2210469836)
Payload: afba9b3283c117ccb012ceb683c117ccb0141047
</code></pre>
</div>
<h1><a class="header" href="#volume-control" id="volume-control">Volume Control</a></h1>
<p>Audio volume can be changed using a <code>SET_PARAMETER</code> request. The volume
is a float value representing the audio attenuation in dB. A value of
–144 means the audio is muted. Then it goes from –30 to 0.</p>
<p><span class="ex">Example:</span> set audio volume</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">SET_PARAMETER rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 6
Session: 1
Content-Type: text/parameters
Content-Length: 20
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575

volume: -11.123877
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 6
</code></pre>
</div>
<h1><a class="header" href="#metadata" id="metadata">Metadata</a></h1>
<p>Metadata for the current track are sent using <code>SET_PARAMETER</code> requests.
This allows the Apple TV to show the track name, artist, album, cover
artwork and timeline. The <code>RTP-Info</code> header contains a <code>rtptime</code> parameter
with the RTP timestamp corresponding to the time from which the metadata
is valid.</p>
<table><thead><tr><th>md</th><th>bit</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>17</td><td>text</td></tr>
<tr><td>1</td><td>15</td><td>artwork</td></tr>
<tr><td>2</td><td>16</td><td>progress</td></tr>
<tr><td></td><td>50</td><td>bplist</td></tr>
</tbody></table>
<h2><a class="header" href="#track-informations" id="track-informations">Track Informations</a></h2>
<p>Informations about the current track are sent in the [DAAP] format, with
<code>application/x-dmap-tagged</code> content type.</p>
<p>The following DAAP attributes are displayed on Apple TV:</p>
<table><thead><tr><th>attributes</th><th>description</th></tr></thead><tbody>
<tr><td>dmap.itemname</td><td>track name</td></tr>
<tr><td>daap.songartist</td><td>artist</td></tr>
<tr><td>daap.songalbum</td><td>album</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> send track informations</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">SET_PARAMETER rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 8
Session: 1
Content-Type: application/x-dmap-tagged
Content-Length: 3242
RTP-Info: rtptime=1146549156
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575

&lt;DMAP DATA&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 8
</code></pre>
</div>
<h2><a class="header" href="#cover-artwork" id="cover-artwork">Cover Artwork</a></h2>
<p>Artworks are sent as <em>JPEG</em> pictures, with <code>image/jpeg</code> content type.</p>
<p><span class="ex">Example:</span> send cover artwork</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">SET_PARAMETER rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 9
Session: 1
Content-Type: image/jpeg
Content-Length: 34616
RTP-Info: rtptime=1146549156
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3) AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575

&lt;JPEG DATA&gt;
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 9
</code></pre>
</div>
<h2><a class="header" href="#playback-progress" id="playback-progress">Playback Progress</a></h2>
<p>Playback progress is sent as <code>text/parameters</code>, with a <code>progress</code> parameter
representing three absolute RTP timestamps values:
<code>start</code> / <code>curr</code> / <code>end</code>.</p>
<table><thead><tr><th>timestamp</th><th>description</th></tr></thead><tbody>
<tr><td>start</td><td>beginning of the current track</td></tr>
<tr><td>curr</td><td>current playback position</td></tr>
<tr><td>end</td><td>end of the current track</td></tr>
</tbody></table>
<p>The relative position and track duration can be computed as follows:</p>
<ul>
<li><code>position = rtptime_to_sec(curr - start)</code></li>
<li><code>duration = rtptime_to_sec(end - start)</code></li>
</ul>
<p><span class="ex">Example:</span> send playback progress</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">SET_PARAMETER rtsp://fe80::217:f2ff:fe0f:e0f6/3413821438 RTSP/1.0
CSeq: 10
Session: 1
Content-Type: text/parameters
Content-Length: 44
User-Agent: iTunes/10.6 (Macintosh; Intel Mac OS X 10.7.3)
AppleWebKit/535.18.5
Client-Instance: 56B29BB6CB904862
DACP-ID: 56B29BB6CB904862
Active-Remote: 1986535575

progress: 1146221540/1146549156/1195701740
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
Server: AirTunes/130.14
CSeq: 10
</code></pre>
</div>
<h1><a class="header" href="#airport-express-authentication" id="airport-express-authentication">AirPort Express Authentication</a></h1>
<p>Sending audio data to the AirPort Express requires a <em>RSA</em> based
authentication. All binary data are encoded using [Base64] without padding.</p>
<h2><a class="header" href="#client-side" id="client-side">Client side</a></h2>
<ul>
<li>In the <code>ANNOUNCE</code> request, the client sends a 128-bit random number in
the <code>Apple-Challenge</code> header.</li>
<li>A 128-bit <em>AES</em> key is generated, encrypted with the RSA public key
using the <em>OAEP</em> encryption scheme, and sent along with an
initialization vector in the <code>rsaaeskey</code> and <code>aesiv</code> SDP attributes.</li>
</ul>
<h2><a class="header" href="#server-side" id="server-side">Server side</a></h2>
<ul>
<li>The AirPort Express decrypts the AES key with its RSA private key, it
will be used to decrypt the audio payload.</li>
<li>The AirPort Express signs the <code>Apple-Challenge</code> number with its RSA
private key using the <em>PKCS#1</em> signature scheme and send the result in
the <code>Apple-Response</code> header.</li>
</ul>
<h2><a class="header" href="#client-side-1" id="client-side-1">Client side</a></h2>
<ul>
<li>The client decrypts the <code>Apple-Response</code> value with the RSA public key,
and checks that it is the same random number it has previously generated.</li>
</ul>
<p><span class="ex">Example:</span> AirPort Express challenge/response</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">ANNOUNCE rtsp://10.0.1.101/3172942895 RTSP/1.0
CSeq: 1
Content-Type: application/sdp
Content-Length: 567
User-Agent: iTunes/4.6 (Windows; N)
Client-Instance: 9FF35780A8BC8D2B
Apple-Challenge: 09KF45soMYmvj6dpsUGiIg

v=0
o=iTunes 3172942895 0 IN IP4 10.0.1.101
s=iTunes
c=IN IP4 10.0.1.103
t=0 0
m=audio 0 RTP/AVP 96
a=rtpmap:96 AppleLossless
a=fmtp:96 4096 0 16 40 10 14 2 255 0 0 44100
a=rsaaeskey:5QYIqmdZGTONY5SHjEJrqAhaa0W9wzDC5i6q221mdGZJ5ubO6Kg
      yhC6U83wpY87TFdPRdfPQl2kVC7+Uefmx1bXdIUo07ZcJsqMbgtje4w2JQw0b
      Uw2BlzNPmVGQOxfdpGc3LXZzNE0jI1D4conUEiW6rrzikXBhk7Y/i2naw13ayy
      xaSwtkiJ0ltBQGYGErbV2tx43QSNj7O0JIG9GrF2GZZ6/UHo4VH+ZXgQ4NZvP/
      QXPCsLutZsvusFDzIEq7TN1fveINOiwrzlN+bckEixvhXlvoQTWE2tjbmQYhMvO
      FIly5gNbZiXi0l5AdolX4jDC2vndFHqWDks/3sPikNg
a=aesiv:zcZmAZtqh7uGcEwPXk0QeA
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">RTSP/1.0 200 OK
CSeq: 1
Apple-Response: u+msU8Cc7KBrVPjI/Ir8fOL8+C5D3Jsw1+acaW3MNTndrTQAeb/a
          5m10UVBX6wb/DYQGY+b28ksSwBjN0nFOk4Y2cODEf83FAh7B
          mkLpmpkpplp7zVXQ+Z9DcB6gC60ZsS3t98aoR7tSzVLKZNgi2X2sC+vGsz
          utQxX03HK008VjcdngHv3g1p2knoETd07T6eVfZCmPqp6Ga7Dj8VIIj/GEP3
          AjjDx3lJnQBXUDmxM484YXLXZjWFXCiY8GJt6whjf7/2c3rIoT3Z7PQpEvPmM
          1MXU9cv4NL59Y/q0OAVQ38foOz7eGAhfvjOsCnHU25aik7/7ToIYt1tyVtap/kA
Audio-Jack-Status: connected; type=analog
</code></pre>
</div>
<h1><a class="header" href="#remote-control" id="remote-control">Remote Control</a></h1>
<p>Audio speakers can send commands to the AirPlay client to change the
current track, pause and resume playback, shuffle the playlist, and
more. This uses a subset of [DACP].
An AirPlay client advertises this capability by including a <code>DACP-ID</code> header in
its RTSP requests, with a 64-bit ID for the DACP server. An <code>Active-Remote</code>
header is included as well, serving as an authentication token.</p>
<p>The AirPlay server needs to browse the mDNS <code>_dacp._tcp</code> services for a
matching DACP server. Server names look like <code>iTunes_Ctrl_$ID</code>.</p>
<p class="caption">DACP service from iTunes</p>
<pre><code>name: iTunes_Ctrl_56B29BB6CB904862
type: _dacp._tcp
port: 3689
txt:
txtvers=1
Ver=131075
DbId=63B5E5C0C201542E
OSsi=0x1F5
</code></pre>
<p>Once the DACP server has been identified, HTTP requests can be sent to the
corresponding service port. The <code>Active-Remote</code> header must be included in
these requests, so no additional pairing is required. The location for
remote control commands is <code>/ctrl-int/1/$CMD</code>. The following commands are
available:</p>
<table><thead><tr><th>command</th><th>description</th></tr></thead><tbody>
<tr><td>beginff</td><td>begin fast forward</td></tr>
<tr><td>beginrew</td><td>begin rewind</td></tr>
<tr><td>mutetoggle</td><td>toggle mute status</td></tr>
<tr><td>nextitem</td><td>play next item in playlist</td></tr>
<tr><td>previtem</td><td>play previous item in playlist</td></tr>
<tr><td>pause</td><td>pause playback</td></tr>
<tr><td>playpause</td><td>toggle between play and pause</td></tr>
<tr><td>play</td><td>start playback</td></tr>
<tr><td>stop</td><td>stop playback</td></tr>
<tr><td>playresume</td><td>play after fast forward or rewind</td></tr>
<tr><td>shuffle_songs</td><td>shuffle playlist</td></tr>
<tr><td>volumedown</td><td>turn audio volume down</td></tr>
<tr><td>volumeup</td><td>turn audio volume up</td></tr>
</tbody></table>
<p><span class="ex">Example:</span> send a pause command</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">GET /ctrl-int/1/pause HTTP/1.1
Host: starlight.local.
Active-Remote: 1986535575
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">HTTP/1.1 204 No Content
Date: Tue, 06 Mar 2012 16:38:51 GMT
DAAP-Server: iTunes/10.6 (Mac OS X)
Content-Type: application/x-dmap-tagged
Content-Length: 0
</code></pre>
</div>
<h1><a class="header" href="#screen-mirroring" id="screen-mirroring">Screen Mirroring</a></h1>
<p>Screen mirroring is achieved by transmitting an <em>H.264</em> encoded video
stream over a TCP connection. This stream is packetized with a 128-byte
header. <em>AAC-ELD</em> audio is sent using the AirTunes protocol. As for the
master clock, it is synchronized using <em>NTP</em>.</p>
<p>Moreover, as soon as a client starts a video playback, a standard
AirPlay connection is made to send the video URL, and mirroring is
stopped. This avoids decoding and re-encoding the video, which would
incur a quality loss.</p>
<h1><a class="header" href="#http-requests-2" id="http-requests-2">HTTP requests</a></h1>
<p>Screen mirroring does not use the standard AirPlay service. Instead it
connects to an apparently hard-coded port 7100. This is a HTTP server
which supports the following requests:</p>
<h2><a class="header" href="#get-streamxml" id="get-streamxml">GET /stream.xml</a></h2>
<p>Retrieve information about the server capabilities. The server sends an
XML property list with the following properties:</p>
<table><thead><tr><th>key</th><th>type</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>height</td><td>integer</td><td>720</td><td>vertical resolution</td></tr>
<tr><td>width</td><td>integer</td><td>1280</td><td>horizontal resolution</td></tr>
<tr><td>overscanned</td><td>boolean</td><td>true</td><td>is the display overscanned?</td></tr>
<tr><td>refreshRate</td><td>real</td><td>0.01666…</td><td>refresh rate 60 Hz (1/60)</td></tr>
<tr><td>version</td><td>string</td><td>130.14</td><td>server version</td></tr>
</tbody></table>
<p>These properties tell us that the AirPlay server is connected to a
1280x720, 60 Hz, overscanned display.</p>
<p><span class="ex">Example:</span> fetch mirroring server informations</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">GET /stream.xml HTTP/1.1
Content-Length: 0
</code></pre>
</div>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Date: Mon, 08 Mar 2012 15:30:27 GMT
Content-Type: text/x-apple-plist+xml
Content-Length: 411
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;
&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;height&lt;/key&gt;
  &lt;integer&gt;720&lt;/integer&gt;
  &lt;key&gt;overscanned&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;refreshRate&lt;/key&gt;
  &lt;real&gt;0.016666666666666666&lt;/real&gt;
  &lt;key&gt;version&lt;/key&gt;
  &lt;string&gt;130.14&lt;/string&gt;
  &lt;key&gt;width&lt;/key&gt;
  &lt;integer&gt;1280&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h2><a class="header" href="#post-stream" id="post-stream">POST /stream</a></h2>
<p>Start the live video transmission. The client sends a binary property
list with information about the stream, immediately followed by the
stream itself. At this point, the connection is no longer a valid HTTP
connection.</p>
<p>The following parameters are sent:</p>
<table><thead><tr><th>key</th><th>type</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>deviceID</td><td>integer</td><td>181221086727016</td><td>MAC address (A4:D1:D2:80:0B:68)</td></tr>
<tr><td>sessionID</td><td>integer</td><td>–808788724</td><td>session ID (0xcfcadd0c)</td></tr>
<tr><td>version</td><td>string</td><td>130.16</td><td>server version</td></tr>
<tr><td>param1</td><td>data</td><td>(72 bytes)</td><td>AES key, encrypted with FairPlay</td></tr>
<tr><td>param2</td><td>data</td><td>(16 bytes)</td><td>AES initialization vector</td></tr>
<tr><td>latencyMs</td><td>integer</td><td>90</td><td>video latency in ms</td></tr>
<tr><td>fpsInfo</td><td>array</td><td></td><td></td></tr>
<tr><td>timestampInfo</td><td>array</td><td></td><td></td></tr>
</tbody></table>
<p>The <code>param1</code> and <code>param2</code> parameters are optional.</p>
<p>As soon as the server receives a <code>/stream</code> request, it will send NTP
requests to the client on port 7010, which seems hard-coded as well. The
client needs to export its master clock there, which will be used for
audio/video synchronization and clock recovery.</p>
<p><span class="ex">Example:</span> send stream information</p>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">POST /stream HTTP/1.1
X-Apple-Device-ID: 0xa4d1d2800b68
Content-Length: 503

&lt;BINARY PLIST DATA&gt;
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;
&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;deviceID&lt;/key&gt;
  &lt;integer&gt;181221086727016&lt;/integer&gt;
  &lt;key&gt;fpsInfo&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;SubS&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;B4En&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;EnDp&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;IdEn&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;IdDp&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;EQDp&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;QueF&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;Sent&lt;/string&gt; &lt;/dict&gt;
  &lt;/array&gt;
  &lt;key&gt;latencyMs&lt;/key&gt;
  &lt;integer&gt;90&lt;/integer&gt;
  &lt;key&gt;param1&lt;/key&gt;
  &lt;data&gt;
    RlBMWQECAQAAAAA8AAAAANvKuDizduszL1hG9IvIk+AAAAAQukdPJ5Jw/gGBAl22WZdF
    m9ujZEGIV7jm3ZByWm51HjpDwjYY
  &lt;/data&gt;
  &lt;key&gt;param2&lt;/key&gt;
  &lt;data&gt;
    3qpOHtYWbBPyEWPnGt1BuQ==
  &lt;/data&gt;
  &lt;key&gt;sessionID&lt;/key&gt;
  &lt;integer&gt;-808788724&lt;/integer&gt;
  &lt;key&gt;timestampInfo&lt;/key&gt;
  &lt;array&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;SubSu&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;BePxT&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;AfPxT&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;BefEn&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;EmEnc&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;QueFr&lt;/string&gt; &lt;/dict&gt;
    &lt;dict&gt; &lt;key&gt;name&lt;/key&gt; &lt;string&gt;SndFr&lt;/string&gt; &lt;/dict&gt;
  &lt;/array&gt;
  &lt;key&gt;version&lt;/key&gt;
  &lt;string&gt;130.16&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
</div>
<h1><a class="header" href="#stream-packets" id="stream-packets">Stream Packets</a></h1>
<p>The video stream is packetized using 128-byte headers, followed by an
optional payload. Only the first 64 bytes of headers seem to be used.
Headers start with the following little-endian fields:</p>
<table><thead><tr><th>size</th><th>description</th></tr></thead><tbody>
<tr><td>4 bytes</td><td>payload size</td></tr>
<tr><td>2 bytes</td><td>payload type</td></tr>
<tr><td>2 bytes</td><td>0x1e if type = 2, else 6</td></tr>
<tr><td>8 bytes</td><td>NTP timestamp</td></tr>
</tbody></table>
<p>There are 3 types of packets:</p>
<table><thead><tr><th>type</th><th>description</th></tr></thead><tbody>
<tr><td>0</td><td>video bitstream</td></tr>
<tr><td>1</td><td>codec data</td></tr>
<tr><td>2</td><td>heartbeat</td></tr>
</tbody></table>
<h2><a class="header" href="#codec-data" id="codec-data">Codec Data</a></h2>
<p>This packet contains the H.264 extra data in <em>avcC</em> format
(<a href="http://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=55980">ISO/IEC 14496:15</a>).
It is sent at the beginning of the stream, each time the
video properties might change, when screen orientation changes, and when
the screen is turned on or off.</p>
<p class="caption">H.264 codec data from iPad</p>
<pre><code class="language-hex">0000   01 64 c0 28 ff e1 00 10 67 64 c0 28 ac 56 20 0d
0010   81 4f e5 9b 81 01 01 01 01 00 04 28 ee 3c b0
</code></pre>
<p>The H.264 codec data is interpreted as follows:</p>
<table><thead><tr><th>size</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td>1 byte</td><td>1</td><td>version</td></tr>
<tr><td>1 byte</td><td>100</td><td>profile (high)</td></tr>
<tr><td>1 byte</td><td>0xc0</td><td>compatibility</td></tr>
<tr><td>1 byte</td><td>40</td><td>level (4.0)</td></tr>
<tr><td>6 bits</td><td>0x3f</td><td>reserved</td></tr>
<tr><td>2 bits</td><td>3</td><td>NAL units length size - 1</td></tr>
<tr><td>3 bits</td><td>0x7</td><td>reserved</td></tr>
<tr><td>5 bits</td><td>1</td><td>number of SPS</td></tr>
<tr><td>2 bytes</td><td>16</td><td>length of SPS</td></tr>
<tr><td>16 bytes</td><td>…</td><td>Sequence parameter set</td></tr>
<tr><td>1 byte</td><td>1</td><td>number of PPS</td></tr>
<tr><td>2 bytes</td><td>4</td><td>length of PPS</td></tr>
<tr><td>4 bytes</td><td>…</td><td>Picture parameter set</td></tr>
</tbody></table>
<p class="caption">Codec data packet from iPad</p>
<pre><code class="language-hex">0000   1f 00 00 00 01 00 06 00 1d 9a 9f 59 ef de 00 00
0010   00 00 58 44 00 00 22 44 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 58 44 00 00 22 44
0030   00 00 50 43 00 00 10 42 00 c0 57 44 00 c0 21 44
0040   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0050   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0060   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0070   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0080   01 64 c0 28 ff e1 00 10 67 64 c0 28 ac 56 20 0d
0090   81 4f e5 9b 81 01 01 01 01 00 04 28 ee 3c b0
</code></pre>
<h2><a class="header" href="#video-bitstream" id="video-bitstream">Video Bitstream</a></h2>
<p>This packet contains the video bitstream to be decoded. The payload can
be optionally AES encrypted. The NTP timestamp found in the header
serves as presentation timestamp.</p>
<p class="caption">Video bitstream packet from iPad</p>
<pre><code class="language-hex">0000   c8 08 00 00 00 00 06 00 e9 e6 f5 ac 60 e0 00 00
0010   58 37 6e f9 40 01 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 58 44 00 00 22 44
0030   00 00 50 43 00 00 10 42 00 c0 57 44 00 c0 21 44
0040   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0050   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0060   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0070   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0080   ...
</code></pre>
<h2><a class="header" href="#heartbeat" id="heartbeat">Heartbeat</a></h2>
<p>Sent every second, this packet does not contain any payload.</p>
<p class="caption">Heartbeat packet from iPad</p>
<pre><code class="language-hex">0000   00 00 00 00 02 00 1e 00 00 00 00 00 00 00 00 00
0010   4d d8 1a 41 00 00 00 00 00 00 20 41 86 c9 e2 36
0020   00 00 00 00 80 88 44 4b 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0050   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0060   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0070   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
</code></pre>
<h1><a class="header" href="#time-synchronization" id="time-synchronization">Time Synchronization</a></h1>
<p>Time synchronization takes place on UDP ports 7010 (client) and 7011
(server), using the [NTP] protocol. The AirPlay server runs
an NTP client. Requests are sent to the AirPlay client at 3 second
intervals. The reference date for the timestamps is the beginning of the
mirroring session.</p>
<div class="server_client">
<p>server &rarr; client</p>
<pre><code class="language-http">0000   23 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 01 c4 c8 ac 5d b5

Network Time Protocol
Flags: 0x23
  00.. .... = Leap Indicator: no warning (0)
  ..10 0... = Version number: NTP Version 4 (4)
  .... .011 = Mode: client (3)
Peer Clock Stratum: unspecified or invalid (0)
Peer Polling Interval: invalid (0)
Peer Clock Precision: 1.000000 sec
Root Delay: 0.0000 sec
Root Dispersion: 0.0000 sec
Reference ID: NULL
Reference Timestamp: Jan 1, 1970 00:00:00.000000000 UTC
Origin Timestamp: Jan 1, 1970 00:00:00.000000000 UTC
Receive Timestamp: Jan 1, 1970 00:00:00.000000000 UTC
Transmit Timestamp: Jan 1, 1900 00:07:32.783880000 UTC
</code></pre>
</div>
<div class="client_server">
<p>client &rarr; server</p>
<pre><code class="language-http">0000   24 01 02 e8 00 00 00 00 00 00 00 00 41 49 52 50
0010   00 00 00 00 00 00 00 00 00 00 01 c4 c8 ac 5d b5
0020   00 00 01 c4 c9 6a 0b a1 00 00 01 c4 c9 78 73 d2

Network Time Protocol
Flags: 0x24
  00.. .... = Leap Indicator: no warning (0)
  ..10 0... = Version number: NTP Version 4 (4)
  .... .100 = Mode: server (4)
Peer Clock Stratum: primary reference (1)
Peer Polling Interval: invalid (2)
Peer Clock Precision: 0.000000 sec
Root Delay: 0.0000 sec
Root Dispersion: 0.0000 sec
Reference ID: Unidentified reference source 'AIRP'
Reference Timestamp: Jan 1, 1970 00:00:00.000000000 UTC
Origin Timestamp: Jan 1, 1900 00:07:32.783880000 UTC
Receive Timestamp: Jan 1, 1900 00:07:32.786774000 UTC
Transmit Timestamp: Jan 1, 1900 00:07:32.786994000 UTC
</code></pre>
</div>
<h1><a class="header" href="#pairing" id="pairing">Pairing</a></h1>
<p>In all newer versions of the protocol pairing is required.</p>
<h1><a class="header" href="#homekit-based-pairings" id="homekit-based-pairings">HomeKit Based Pairings</a></h1>
<p>Default code is <code>3939</code>.</p>
<h2><a class="header" href="#transient-pairing" id="transient-pairing">Transient Pairing</a></h2>
<p><code>POST /pair-setup</code>
<code>EncryptionKey</code> is <code>SRP shared secret</code></p>
<h2><a class="header" href="#normal-pairing" id="normal-pairing">Normal Pairing</a></h2>
<p><code>POST /pair-setup</code>
<code>POST /pair-verify</code></p>
<p><code>EncryptionKey</code> is agreed <code>SessionKey</code></p>
<h2><a class="header" href="#encryption" id="encryption">Encryption</a></h2>
<p>After successful pairing the connection switches to being encrypted using
the format <code>N:n_bytes:tag</code> where <code>N</code> is a 16 bit Little Endian length that
describes the number of bytes in <code>n_bytes</code> and <code>n_bytes</code> is encrypted using
ChaCha20-Poly1305 with <code>tag</code> being the Poly1305 tag.</p>
<p>Each direction uses its own key and nonce.</p>
<p>The key for data sent from client to accessory is a HKDF-SHA-512 with the
following parameters:</p>
<pre><code>InputKey = &lt;EncryptionKey&gt;
Salt = ”Control-Salt”
Info = ”Control-Write-Encryption-Key”
OutputSize = 32 bytes
</code></pre>
<p>While the data sent from accessory to client is HKDF-SHA-512 with the following
parameters:</p>
<pre><code>InputKey = &lt;EncryptionKey&gt;
Salt = ”Control-Salt”
Info = ”Control-Read-Encryption-Key”
OutputSize = 32 bytes
</code></pre>
<p>The nonce is a 64 bit counter (i.e. the high order bits of the full 96 bit
nonce is set to 0) starting with 0 and incrementing by 1 for each encrypted
block.</p>
<h2><a class="header" href="#mfi-authentication" id="mfi-authentication">MFi Authentication</a></h2>
<p>When SupportsUnifiedPairSetupAndMFi is enabled and HKP is used, the device can authenticate when pairing.
In such case M1 step is done with &quot;Pair Setup with Auth&quot; method.</p>
<p>Also, during the M4 step of the pairing process, in addition of the PROOF TLV used in regular pair-setup, the following TLV is added:<br />
<code>TLV: 0x05,N,ENCRYPTED_DATA_WITH_TAG</code> where N (int16) is the length of ENCRYPTED_DATA_WITH_TAG</p>
<p>ENCRYPTED_DATA_WITH_TAG has the following format:<br />
<code>&lt;N:ENCRYPTED_DATA&gt;</code><br />
<code>&lt;16:Poly1305 Tag&gt;</code></p>
<p>ENCRYPTED_DATA is encrypted using a HKDF-SHA-512 key with the following parameters:</p>
<pre><code>InputKey = &lt;SRP Shared key&gt;
Salt = ”Pair-Setup-Encrypt-Salt”
Info = ”Pair-Setup-Encrypt-Info”
Nonce = ”PS-Msg04”
OutputSize = 32 bytes
</code></pre>
<p>Decrypted data contains TLVs, which contain MFi Signature (signed by Apple authenticator IC) and used MFi certificate.
The message is signed using RSA-1024 with SHA-1 hash algorithm. The message signed is a HKDF-SHA-512 key with the following
parameters:</p>
<pre><code>InputKey = &lt;SRP Shared key&gt;
Salt = ”MFi-Pair-Setup-Salt”
Info = ”MFi-Pair-Setup-Info”
OutputSize = 32 bytes
</code></pre>
<h1><a class="header" href="#legacy-pairing" id="legacy-pairing">Legacy Pairing</a></h1>
<p>TBD</p>
<h1><a class="header" href="#known-implementations" id="known-implementations">Known Implementations</a></h1>
<ul>
<li><a href="https://github.com/mikebrady/shairport-sync">https://github.com/mikebrady/shairport-sync</a></li>
<li><a href="https://github.com/juhovh/shairplay">https://github.com/juhovh/shairplay</a></li>
<li><a href="https://github.com/ejurgensen/forked-daapd">https://github.com/ejurgensen/forked-daapd</a></li>
<li><a href="https://github.com/Vluxe/nighthawk">https://github.com/Vluxe/nighthawk</a></li>
<li><a href="https://github.com/philippe44/RAOP-Player">https://github.com/philippe44/RAOP-Player</a></li>
<li><a href="https://github.com/funtax/AirPlayAuth">https://github.com/funtax/AirPlayAuth</a></li>
<li><a href="ttps://github.com/espes/Slave-in-the-Magic-Mirror">https://github.com/espes/Slave-in-the-Magic-Mirror</a></li>
<li><a href="https://github.com/robertoandrade/playfair">https://github.com/robertoandrade/playfair</a></li>
<li><a href="https://github.com/phonegapX/AirPlay">https://github.com/phonegapX/AirPlay</a></li>
</ul>
<p>https://htmlpreview.github.io/?https://github.com/philippe44/RAOP-Player/blob/master/doc/auth_protocol.html</p>
<h1><a class="header" href="#contributing" id="contributing">Contributing</a></h1>
<h2><a class="header" href="#device-data" id="device-data">Device Data</a></h2>
<p>If anybody wants to help out who has some Airplay compatible hardware we
can always use some more data. Primarily we right now need mDNS records
and the results from RTSP <code>GET /info/</code> requests. If you have
a computer other than a windows machine I have written some short guides
below and if that is not enough I can probably help you if you send
an e-mail to <a href="brian@maven-group.org">brian@maven-group.org</a>.</p>
<p>We right now have data for a couple of 4K Apple TVs, an AirPort Express,
two stereo paired HomePods, the Libretone LTH200 and a Denon AVR-X3500X
surround receiver so if your hardware is something else I am especially
interested in the data from it.</p>
<p>Any data that you send will only be viewed by me and I will change stuff
like device names, ip addresses, MAC addresses, serial numbers and UUIDs
before including the data in this spec.</p>
<h3><a class="header" href="#linux" id="linux">Linux</a></h3>
<p>If you are on Linux and have <code>avahi</code> installed you can run the following
shell script to gather all the data.</p>
<pre><code class="language-bash">#!/bin/bash
avahi-browse -prt _airplay._tcp | awk -v &quot;FS=;&quot; '{ print $7 }' | sed '/^\s*$/d' &gt; devices.txt
avahi-browse -aprt | grep -f devices.txt &gt; mDNS.txt
for host in $(cat devices.txt) ; do
PORT=&quot;$(avahi-browse -prt _airplay._tcp | grep &quot;;$host;&quot; | awk -v &quot;FS=;&quot; '{print $9}' | sed '/^\s*$/d')&quot;
curl https://openairplay.github.io/airplay-spec/data/RTSP-get-info-req.bin | nc -w 2 &quot;$host&quot; $PORT &gt; &quot;RTSP-get-info-res-$host.bin&quot;
done
tar czvf device-data.tar.gz mDNS.txt RTSP-get-info-res*
</code></pre>
<p>Then you can send the resulting file <code>device-data.tar.gz</code>
as an e-mail to <a href="mailto:brian@maven-group.org">brian@maven-group.org</a></p>
<h3><a class="header" href="#macos" id="macos">macOS</a></h3>
<p>To find mDNS records on macOS I usually use the free
<a href="https://itunes.apple.com/dk/app/discovery-dns-sd-browser/id1381004916?mt=12">Discovery</a>.
From there you can find all the devices that publish a <code>_airplay._tcp</code>
service, select and copy/paste the results into an e-mail. It is also
relevant if you can find what other services those devices publish and
include the service records for those services.</p>
<p>To get the RTSP <code>GET /info</code> results you will need the ip address and
port number your devices use for <code>_airplay._tcp</code> and in the command below
replace <code>[ip address]</code>, <code>[port]</code> and <code>[device name]</code> with the correct values.</p>
<pre><code class="language-bash">curl https://openairplay.github.io/airplay-spec/data/RTSP-get-info-req.bin | nc -w 2 [ip address] [port] &gt; RTSP-get-info-res-[device name].bin
</code></pre>
<p>Then you can send the mDNS records and <code>RTSP-get-info-res-[device name].bin</code>
files in an e-mail to <a href="mailto:brian@maven-group.org">brian@maven-group.org</a></p>
<h1><a class="header" href="#history" id="history">History</a></h1>
<table><thead><tr><th>Date</th><th>Changes</th></tr></thead><tbody>
<tr><td>2012–03–20</td><td>Initial version.</td></tr>
<tr><td>2019–04–30</td><td>Updated with data from reverse engineering <code>AirPlaySender.framework</code>.</td></tr>
<tr><td>2019–05–01</td><td>Cleaned up HTML and added a little interactivity.</td></tr>
<tr><td>2019–05–01</td><td>Added data for Libretone</td></tr>
<tr><td>2019–05–01</td><td>Add contributing section</td></tr>
<tr><td>2019–05–02</td><td>Add more example devices and click on flag to change</td></tr>
<tr><td>2019–12–23</td><td>Rewrite as mdBook</td></tr>
</tbody></table>
<h1><a class="header" href="#resources" id="resources">Resources</a></h1>
<h2><a class="header" href="#ietf-rfcs" id="ietf-rfcs">IETF RFCs</a></h2>
<ul>
<li><a id="ref1" href="resources.html#ref1">[1]</a> <a href="https://tools.ietf.org/html/rfc2616">RFC 2616</a>: Hypertext Transfer Protocol – HTTP/1.1</li>
<li>[HTTPBasic] <a href="https://tools.ietf.org/html/rfc2617">RFC 2617</a>: HTTP Authentication: Basic and Digest Access Authentication</li>
<li>[RTSP] <a href="https://tools.ietf.org/html/rfc2326">RFC 2326</a>: Real Time Streaming Protocol (RTSP)</li>
<li>[SDP] <a href="https://tools.ietf.org/html/rfc4566">RFC 4566</a>: SDP: Session Description Protocol</li>
<li>[RTP] <a href="https://tools.ietf.org/html/rfc3550">RFC 3550</a>: RTP: A Transport Protocol for Real-Time Applications</li>
<li>[NTP] <a href="https://tools.ietf.org/html/rfc5905">RFC 5905</a>: Network Time Protocol Version 4</li>
<li>[Base64] <a href="https://tools.ietf.org/html/rfc4648">RFC 4648</a>: The Base16, Base32, and Base64 Data Encodings</li>
<li>[mDNS] <a href="https://tools.ietf.org/html/rfc6762">RFC 6762</a>: Multicast DNS</li>
<li>[DNS-SD] <a href="https://tools.ietf.org/html/rfc6763">RFC 6763</a>: DNS-Based Service Discovery</li>
<li>[HLS] <a href="https://tools.ietf.org/html/rfc8216">RFC 8216</a>: HTTP Live Streaming</li>
</ul>
<h2><a class="header" href="#ietf-drafts" id="ietf-drafts">IETF drafts</a></h2>
<ul>
<li><a href="http://tools.ietf.org/id/draft-lentczner-rhttp-00.txt">Reverse HTTP</a></li>
</ul>
<h2><a class="header" href="#apple-protocols" id="apple-protocols">Apple Protocols</a></h2>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Digital_Audio_Access_Protocol">DAAP</a>: Digital Audio Access Protocol</li>
<li><a href="http://en.wikipedia.org/wiki/Digital_Audio_Control_Protocol">DACP</a>: Digital Audio Control Protocol</li>
<li><a href="http://en.wikipedia.org/wiki/Remote_Audio_Output_Protocol">RAOP</a>: Remote Audio Output Protocol</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        
        <script type="text/javascript" src="js/app.js" charset="utf-8"></script>
        

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
